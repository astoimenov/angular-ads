"use strict";var adsApp=angular.module("adsApp",["ngRoute","ngResource","LocalStorageModule","validation.match","ui.bootstrap.pagination"]).config(["$routeProvider","localStorageServiceProvider",function(e,t){e.when("/",{title:"Home",templateUrl:"templates/home.html",controller:"HomeCtrl"}),e.when("/login",{title:"Login",templateUrl:"templates/login.html",controller:"LoginCtrl"}),e.when("/register",{title:"Register",templateUrl:"templates/register.html",controller:"RegisterCtrl"}),e.when("/user/home",{title:"Home",templateUrl:"templates/user-home.html",controller:"UserHomeCtrl"}),e.when("/user/ads",{title:"My ads",templateUrl:"templates/user-home.html",controller:"UserAdsCtrl"}),e.when("/user/ads/publish",{title:"Publish new ad",templateUrl:"templates/publish-new-ad.html",controller:"PublishNewAdCtrl"}),e.when("/user/ads/edit/:id",{title:"Edit ad",templateUrl:"templates/edit-ad.html",controller:"EditAdCtrl"}),e.when("/user/ads/delete/:id",{title:"Delete ad",templateUrl:"templates/delete-ad.html",controller:"DeleteAdCtrl"}),e.when("/user/profile",{title:"Edit user profile",templateUrl:"templates/edit-profile.html",controller:"EditProfileCtrl"}),e.otherwise({redirectTo:"/"}),t.setStorageType("localStorage")}]);adsApp.constant("baseServiceUrl","http://softuni-ads.azurewebsites.net/api/"),adsApp.constant("pageSize",5),adsApp.run(["$rootScope","$location","authentication",function(e,t,r){e.$on("$routeChangeSuccess",function(t,r){e.title=r.$$route.title}),e.$on("$locationChangeStart",function(){-1==t.path().indexOf("/user/")||r.isLoggedIn()||t.path("/")})}]),adsApp.controller("DeleteAdCtrl",["$scope","$location","$routeParams","userAdsData","notification",function(e,t,r,a,o){e.homeLink="user/home";var n=r.id;a.getAdById(n).$promise.then(function(t){e.ad=t},function i(i){o.showError("Advertisement can not be deleted",i)}),e.delete=function(e){a.delete(e).$promise.then(function(){o.showInfo("Advertisement deleted"),t.path("/user/ads")},function r(r){o.showError("Advertisement can not be deleted",r)})}}]),adsApp.controller("EditAdCtrl",["$scope","$routeParams","$location","townsData","categoriesData","userAdsData","notification",function(e,t,r,a,o,n,i){e.homeLink="user/home";var s=t.id,d=!1;n.getAdById(s).$promise.then(function(t){e.adData=t},function l(l){i.showError("Advertisement can not be edited",l)}),e.categories=o.getCategories(),e.towns=a.getTowns(),e.deleteImage=function(){delete e.adData.imageDataUrl,d=!0},e.fileSelected=function(t){delete e.adData.imageDataUrl;var r=t.files[0];if(r.type.match(/image\/.*/)){var a=new FileReader;a.onload=function(){e.adData.imageDataUrl=a.result,d=!0,$(".image-box").html("<img src='"+a.result+"'>")},a.readAsDataURL(r)}else $(".image-box").html("<p>File type not supported!</p>")},e.edit=function(e){e.changeImage=d,n.edit(s,e).$promise.then(function(){i.showInfo("Advertisement edited. Don't forget to submit it for publishing."),r.path("/user/ads")},function t(t){i.showError("Editing failed",t)})}}]),adsApp.controller("EditProfileCtrl",["$scope","$location","townsData","userData","notification",function(e,t,r,a,o){e.homeLink="user/home",e.pass={oldPassword:null,newPassword:null,confirmPassword:null},e.towns=r.getTowns(),e.user=a.getUserProfile(),e.edit=function(e){a.edit(e).$promise.then(function(){o.showInfo("User profile successfully updated."),t.path("/user/home")},function r(r){o.showError("User profile is not updated.",r)})},e.changePassword=function(e){a.changePassword(e).$promise.then(function(){o.showInfo("Password successfully updated."),t.path("/user/home")},function r(r){o.showError("Password is not updated.",r)})}}]),adsApp.controller("HomeCtrl",["$scope","$location","$route","userData","authentication",function(e,t,r,a,o){e.authentication=o,e.isLoggedIn=o.isLoggedIn(),e.logout=function(e){a.logout(e),"/"==t.$$path?r.reload():t.path("/")}}]),adsApp.controller("LoginCtrl",["$scope","$location","userData","notification",function(e,t,r,a){e.login=function(e){r.login(e).$promise.then(function(){a.showInfo("Login successful"),t.path("/user/home")},function o(o){a.showError("Invalid login",o)})}}]),adsApp.controller("ManageAdMenuCtrl",["$scope","$route","userAdsData","notification",function(e,t,r,a){e.deactivate=function(e){r.deactivate(e).$promise.then(function(){a.showInfo("Ad is deactivated"),t.reload()},function o(o){a.showError("Can't deactivate the ad",o)})},e.publishAgain=function(e){r.publishAgain(e).$promise.then(function(){a.showInfo("Ad is published again for approval."),t.reload()},function o(o){a.showError("Can't publish the ad",o)})}}]),adsApp.controller("PublicAdsCtrl",["$scope","adsData","pageSize","notification",function(e,t,r,a){e.ready=!1,e.adsParams={startPage:1,pageSize:r},e.reloadAds=function(){t.getPublicAds(e.adsParams).$promise.then(function(t){e.ads=t,e.ready=!0},function r(r){a.showError("Cannot load ads",r)})},e.reloadAds(),e.$on("categorySelectionChanged",function(t,r){e.adsParams.categoryId=r,e.adsParams.startPage=1,e.reloadAds()}),e.$on("townSelectionChanged",function(t,r){e.adsParams.townId=r,e.adsParams.startPage=1,e.reloadAds()})}]),adsApp.controller("PublishNewAdCtrl",["$scope","$location","townsData","categoriesData","userAdsData","notification",function(e,t,r,a,o,n){e.homeLink="user/home",e.adData={townId:null,categoryId:null},e.categories=a.getCategories(),e.towns=r.getTowns(),e.fileSelected=function(t){delete e.adData.imageDataUrl;var r=t.files[0];if(r.type.match(/image\/.*/)){var a=new FileReader;a.onload=function(){e.adData.imageDataUrl=a.result,$(".image-box").html("<img src='"+a.result+"'>")},a.readAsDataURL(r)}else $(".image-box").html("<p>File type not supported!</p>")},e.publishAd=function(e){null==e.imageDataUrl&&(e.imageDataUrl=""),o.add(e).$promise.then(function(){n.showInfo("Advertisement submitted dor approval. Once approved, it will be published."),t.path("/user/ads")},function r(r){n.showError("Publishing failed",r)})}}]),adsApp.controller("RegisterCtrl",["$scope","$location","townsData","userData","notification",function(e,t,r,a,o){e.towns=r.getTowns(),e.register=function(e){a.register(e).$promise.then(function(){o.showInfo("User account created. Please log in."),t.path("/login")},function r(r){o.showError("Invalid registration",r)})}}]),adsApp.controller("RightSidebarCtrl",["$scope","$rootScope","townsData","categoriesData",function(e,t,r,a){e.categories=a.getCategories(),e.towns=r.getTowns(),e.categoryClicked=function(r){e.selectedCategoryId=r,t.$broadcast("categorySelectionChanged",r)},e.townClicked=function(r){e.selectedTownId=r,t.$broadcast("townSelectionChanged",r)}}]),adsApp.controller("StatusFilterCtrl",["$scope","$rootScope",function(e,t){e.statusClicked=function(r){e.selectedStatusId=r,t.$broadcast("statusSelectionChanged",r)}}]),adsApp.controller("UserAdsCtrl",["$scope","$route","adsData","userAdsData","userData","pageSize","notification",function(e,t,r,a,o,n,i){e.homeLink="user/home",e.inMyAds=!0,e.ready=!1,e.adsParams={startPage:1,pageSize:n},e.reloadAds=function(){a.getUserAds(e.adsParams).$promise.then(function(t){e.ads=t,e.ready=!0},function t(t){i.showError("Cannot load ads",t)})},e.reloadAds(),e.$on("categorySelectionChanged",function(t,r){e.adsParams.categoryId=r,e.adsParams.startPage=1,e.reloadAds()}),e.$on("townSelectionChanged",function(t,r){e.adsParams.townId=r,e.adsParams.startPage=1,e.reloadAds()}),e.$on("statusSelectionChanged",function(t,r){e.adsParams.status=r,e.adsParams.startPage=1,e.reloadAds()})}]),adsApp.controller("UserHomeCtrl",["$scope","$location","$route","userData","authentication",function(e,t,r,a,o){e.homeLink="user/home",e.authentication=o,e.isLoggedIn=o.isLoggedIn(),e.inHome="/user/home"==t.$$path,e.inMyAds="/user/ads"==t.$$path,e.inPublishNew="/user/ads/publish"==t.$$path,e.logout=function(e){a.logout(e),"/"==t.$$path?r.reload():t.path("/")}}]),adsApp.directive("categories",function(){return{controller:"RightSidebarCtrl",restrict:"E",templateUrl:"templates/directives/categories.html",replace:!0}}),adsApp.directive("changeTitleOnBlur",[function(){return{restrict:"A",scope:!0,link:function(e){document.title="Ads - "+e.title,$(window).focus(function(){document.title="Ads - "+e.title}),$(window).blur(function(){document.title="I miss you.."})}}}]),adsApp.directive("loggedInSidebar",function(){return{controller:"HomeCtrl",restrict:"E",templateUrl:"templates/directives/logged-in-sidebar.html",replace:!0}}),adsApp.directive("manageAdMenu",function(){return{controller:"ManageAdMenuCtrl",restrict:"E",templateUrl:"templates/directives/manage-ad-menu.html",replace:!0}}),adsApp.directive("navigation",function(){return{restrict:"E",templateUrl:"templates/directives/navigation.html",replace:!0}}),adsApp.directive("publicAds",function(){return{controller:"PublicAdsCtrl",restrict:"E",templateUrl:"templates/directives/public-ads.html",replace:!0}}),adsApp.directive("publicLeftSidebar",function(){return{controller:"HomeCtrl",restrict:"E",templateUrl:"templates/directives/left-sidebar.html",replace:!0}}),adsApp.directive("statusFilter",function(){return{controller:"StatusFilterCtrl",restrict:"E",templateUrl:"templates/directives/status-filter.html",replace:!0}}),adsApp.directive("towns",function(){return{controller:"RightSidebarCtrl",restrict:"E",templateUrl:"templates/directives/towns.html",replace:!0}}),adsApp.directive("userAds",function(){return{controller:"UserAdsCtrl",restrict:"E",templateUrl:"templates/directives/user-ads.html",replace:!0}}),adsApp.factory("authentication",["localStorageService",function(e){function t(t){e.set(s,t)}function r(){return e.get(s)}function a(){localStorage.removeItem("ls.user")}function o(){var e={},t=r();return t&&(e.Authorization="Bearer "+t.access_token),e}function n(){return r().isAdmin}function i(){return!!r()}var s="user";return{saveUser:t,getUserData:r,removeUser:a,getHeaders:o,isAdmin:n,isLoggedIn:i}}]),adsApp.factory("notification",function(){return{showInfo:function(e){noty({text:e,type:"info",layout:"topCenter",timeout:3e3})},showError:function(e,t){var r=[];if(t&&t.data.error_description&&r.push(t.data.error_description),t&&t.data.modelState){var a=t.data.modelState;for(var o in a)for(var n=a[o],i=o.substr(o.indexOf(".")+1),s=0;s<n.length;s++){var d=n[s];r.push(i+" - "+d)}}r.length>0&&(e=e+":<br>"+r.join("<br>")),noty({text:e,type:"error",layout:"topCenter",timeout:5e3})}}}),adsApp.factory("adsData",["$resource","authentication","baseServiceUrl",function(e,t,r){function a(e){return i.save(e)}function o(e){return i.getAll(e)}function n(e,t){return i.update({id:e},t)}var i=e(r+"ads/:adId",{adId:"@id"},{update:{method:"PUT"},getAll:{method:"GET"}});return{add:a,getPublicAds:o,edit:n}}]),adsApp.factory("categoriesData",["$resource","baseServiceUrl",function(e,t){function r(){return a.query()}var a=e(t+"categories");return{getCategories:r}}]),adsApp.factory("townsData",["$resource","baseServiceUrl",function(e,t){function r(){return a.query()}var a=e(t+"towns");return{getTowns:r}}]),adsApp.factory("userAdsData",["$resource","authentication","baseServiceUrl",function(e,t,r){function a(e){return c.save(e)}function o(e){return c.getAll(e)}function n(e){return c.get({adId:e})}function i(e,t){return c.update({adId:e},t)}function s(a){var o=e(r+"user/ads/deactivate/:adId",{adId:"@id"},{update:{method:"PUT",headers:t.getHeaders()}});return o.update({id:a})}function d(a){var o=e(r+"user/ads/publishagain/:adId",{adId:"@id"},{update:{method:"PUT",headers:t.getHeaders()}});return o.update({id:a})}function l(e){return c.remove({adId:e})}var c=e(r+"user/ads/:adId",{adId:"@id"},{update:{method:"PUT",headers:t.getHeaders()},getAll:{method:"GET",headers:t.getHeaders()},get:{method:"GET",headers:t.getHeaders()},remove:{method:"DELETE",headers:t.getHeaders()},save:{method:"POST",headers:t.getHeaders()}});return{add:a,getUserAds:o,getAdById:n,edit:i,deactivate:s,publishAgain:d,"delete":l}}]),adsApp.factory("userData",["$http","$resource","baseServiceUrl","authentication",function(e,t,r,a){function o(){var e=t(c+"profile",{},{get:{method:"GET",headers:a.getHeaders()}});return e.get()}function n(e){return t(c+"register").save(e)}function i(e){var r=t(c+"login").save(e);return r.$promise.then(function(e){a.saveUser(e)}),r}function s(e){var r=t(c+"profile",{},{update:{method:"PUT",headers:a.getHeaders()}});return r.update(e)}function d(e){var r=t(c+"changePassword",{},{update:{method:"PUT",headers:a.getHeaders()}});return r.update(e)}function l(){a.removeUser()}var c=r+"user/";return{getUserProfile:o,register:n,login:i,edit:s,changePassword:d,logout:l}}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsImNvbnRyb2xsZXJzL0RlbGV0ZUFkQ3RybC5qcyIsImNvbnRyb2xsZXJzL0VkaXRBZEN0cmwuanMiLCJjb250cm9sbGVycy9FZGl0UHJvZmlsZUN0cmwuanMiLCJjb250cm9sbGVycy9Ib21lQ3RybC5qcyIsImNvbnRyb2xsZXJzL0xvZ2luQ3RybC5qcyIsImNvbnRyb2xsZXJzL01hbmFnZUFkTWVudUN0cmwuanMiLCJjb250cm9sbGVycy9QdWJsaWNBZHNDdHJsLmpzIiwiY29udHJvbGxlcnMvUHVibGlzaE5ld0FkQ3RybC5qcyIsImNvbnRyb2xsZXJzL1JlZ2lzdGVyQ3RybC5qcyIsImNvbnRyb2xsZXJzL1JpZ2h0U2lkZWJhckN0cmwuanMiLCJjb250cm9sbGVycy9TdGF0dXNGaWx0ZXJDdHJsLmpzIiwiY29udHJvbGxlcnMvVXNlckFkc0N0cmwuanMiLCJjb250cm9sbGVycy9Vc2VySG9tZUN0cmwuanMiLCJkaXJlY3RpdmVzL2NhdGVnb3JpZXMuanMiLCJkaXJlY3RpdmVzL2NoYW5nZS10aXRsZS1vbi1ibHVyLmpzIiwiZGlyZWN0aXZlcy9sb2dnZWQtaW4tc2lkZWJhci5qcyIsImRpcmVjdGl2ZXMvbWFuYWdlLWFkLW1lbnUuanMiLCJkaXJlY3RpdmVzL25hdmlnYXRpb24uanMiLCJkaXJlY3RpdmVzL3B1YmxpYy1hZHMuanMiLCJkaXJlY3RpdmVzL3B1YmxpYy1sZWZ0LXNpZGViYXIuanMiLCJkaXJlY3RpdmVzL3N0YXR1cy1maWx0ZXIuanMiLCJkaXJlY3RpdmVzL3Rvd25zLmpzIiwiZGlyZWN0aXZlcy91c2VyLWFkcy5qcyIsInNlcnZpY2VzL2F1dGhlbnRpY2F0aW9uLmpzIiwic2VydmljZXMvbm90aWZpY2F0aW9uLmpzIiwic2VydmljZXMvZGF0YS9hZHNEYXRhLmpzIiwic2VydmljZXMvZGF0YS9jYXRlZ29yaWVzRGF0YS5qcyIsInNlcnZpY2VzL2RhdGEvdG93bnNEYXRhLmpzIiwic2VydmljZXMvZGF0YS91c2VyQWRzRGF0YS5qcyIsInNlcnZpY2VzL2RhdGEvdXNlckRhdGEuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsWUFFQSxJQUFBLFFBQUEsUUFBQSxPQUFBLFVBQ0EsVUFDQSxhQUNBLHFCQUNBLG1CQUNBLDRCQUdBLFFBQ0EsaUJBQ0EsOEJBQ0EsU0FBQSxFQUFBLEdBQ0EsRUFBQSxLQUFBLEtBQ0EsTUFBQSxPQUNBLFlBQUEsc0JBQ0EsV0FBQSxhQUdBLEVBQUEsS0FBQSxVQUNBLE1BQUEsUUFDQSxZQUFBLHVCQUNBLFdBQUEsY0FHQSxFQUFBLEtBQUEsYUFDQSxNQUFBLFdBQ0EsWUFBQSwwQkFDQSxXQUFBLGlCQUdBLEVBQUEsS0FBQSxjQUNBLE1BQUEsT0FDQSxZQUFBLDJCQUNBLFdBQUEsaUJBR0EsRUFBQSxLQUFBLGFBQ0EsTUFBQSxTQUNBLFlBQUEsMkJBQ0EsV0FBQSxnQkFHQSxFQUFBLEtBQUEscUJBQ0EsTUFBQSxpQkFDQSxZQUFBLGdDQUNBLFdBQUEscUJBR0EsRUFBQSxLQUFBLHNCQUNBLE1BQUEsVUFDQSxZQUFBLHlCQUNBLFdBQUEsZUFHQSxFQUFBLEtBQUEsd0JBQ0EsTUFBQSxZQUNBLFlBQUEsMkJBQ0EsV0FBQSxpQkFHQSxFQUFBLEtBQUEsaUJBQ0EsTUFBQSxvQkFDQSxZQUFBLDhCQUNBLFdBQUEsb0JBR0EsRUFBQSxXQUFBLFdBQUEsTUFHQSxFQUFBLGVBQUEsa0JBR0EsUUFBQSxTQUFBLGlCQUFBLDZDQUNBLE9BQUEsU0FBQSxXQUFBLEdBRUEsT0FBQSxLQUFBLGFBQUEsWUFBQSxpQkFBQSxTQUFBLEVBQUEsRUFBQSxHQUVBLEVBQUEsSUFBQSxzQkFBQSxTQUFBLEVBQUEsR0FDQSxFQUFBLE1BQUEsRUFBQSxRQUFBLFFBR0EsRUFBQSxJQUFBLHVCQUFBLFdBQ0EsSUFBQSxFQUFBLE9BQUEsUUFBQSxXQUFBLEVBQUEsY0FFQSxFQUFBLEtBQUEsVUNwRkEsT0FBQSxXQUFBLGdCQUNBLFNBQ0EsWUFDQSxlQUNBLGNBQ0EsZUFDQSxTQUFBLEVBQUEsRUFBQSxFQUNBLEVBQUEsR0FFQSxFQUFBLFNBQUEsV0FDQSxJQUFBLEdBQUEsRUFBQSxFQUVBLEdBQUEsVUFBQSxHQUNBLFNBQ0EsS0FDQSxTQUFBLEdBQ0EsRUFBQSxHQUFBLEdBRUEsUUFBQSxHQUFBLEdBQ0EsRUFBQSxVQUFBLG1DQUFBLEtBSUEsRUFBQSxPQUFBLFNBQUEsR0FDQSxFQUFBLE9BQUEsR0FDQSxTQUNBLEtBQ0EsV0FDQSxFQUFBLFNBQUEseUJBQ0EsRUFBQSxLQUFBLGNBRUEsUUFBQSxHQUFBLEdBQ0EsRUFBQSxVQUFBLG1DQUFBLFNDaENBLE9BQUEsV0FBQSxjQUNBLFNBQ0EsZUFDQSxZQUNBLFlBQ0EsaUJBQ0EsY0FDQSxlQUNBLFNBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxFQUNBLEVBQUEsR0FFQSxFQUFBLFNBQUEsV0FDQSxJQUFBLEdBQUEsRUFBQSxHQUNBLEdBQUEsQ0FFQSxHQUFBLFVBQUEsR0FDQSxTQUNBLEtBQ0EsU0FBQSxHQUNBLEVBQUEsT0FBQSxHQUVBLFFBQUEsR0FBQSxHQUNBLEVBQUEsVUFBQSxrQ0FBQSxLQUlBLEVBQUEsV0FBQSxFQUFBLGdCQUNBLEVBQUEsTUFBQSxFQUFBLFdBRUEsRUFBQSxZQUFBLGlCQUNBLEdBQUEsT0FBQSxhQUNBLEdBQUEsR0FHQSxFQUFBLGFBQUEsU0FBQSxTQUNBLEdBQUEsT0FBQSxZQUNBLElBQUEsR0FBQSxFQUFBLE1BQUEsRUFFQSxJQUFBLEVBQUEsS0FBQSxNQUFBLGFBQUEsQ0FDQSxHQUFBLEdBQUEsR0FBQSxXQUNBLEdBQUEsT0FBQSxXQUNBLEVBQUEsT0FBQSxhQUFBLEVBQUEsT0FDQSxHQUFBLEVBQ0EsRUFBQSxjQUFBLEtBQUEsYUFBQSxFQUFBLE9BQUEsT0FHQSxFQUFBLGNBQUEsT0FFQSxHQUFBLGNBQUEsS0FBQSxvQ0FLQSxFQUFBLEtBQUEsU0FBQSxHQUNBLEVBQUEsWUFBQSxFQUVBLEVBQUEsS0FBQSxFQUFBLEdBQ0EsU0FDQSxLQUNBLFdBQ0EsRUFBQSxTQUNBLG1FQUNBLEVBQUEsS0FBQSxjQUVBLFFBQUEsR0FBQSxHQUNBLEVBQUEsVUFBQSxpQkFBQSxTQ2pFQSxPQUFBLFdBQUEsbUJBQ0EsU0FDQSxZQUNBLFlBQ0EsV0FDQSxlQUNBLFNBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxHQUVBLEVBQUEsU0FBQSxZQUNBLEVBQUEsTUFDQSxZQUFBLEtBQ0EsWUFBQSxLQUNBLGdCQUFBLE1BR0EsRUFBQSxNQUFBLEVBQUEsV0FDQSxFQUFBLEtBQUEsRUFBQSxpQkFFQSxFQUFBLEtBQUEsU0FBQSxHQUNBLEVBQUEsS0FBQSxHQUNBLFNBQ0EsS0FDQSxXQUNBLEVBQUEsU0FBQSxzQ0FDQSxFQUFBLEtBQUEsZUFFQSxRQUFBLEdBQUEsR0FDQSxFQUFBLFVBQUEsK0JBQUEsTUFLQSxFQUFBLGVBQUEsU0FBQSxHQUNBLEVBQUEsZUFBQSxHQUNBLFNBQ0EsS0FDQSxXQUNBLEVBQUEsU0FBQSxrQ0FDQSxFQUFBLEtBQUEsZUFFQSxRQUFBLEdBQUEsR0FDQSxFQUFBLFVBQUEsMkJBQUEsU0N6Q0EsT0FBQSxXQUFBLFlBQ0EsU0FDQSxZQUNBLFNBQ0EsV0FDQSxpQkFDQSxTQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsR0FFQSxFQUFBLGVBQUEsRUFDQSxFQUFBLFdBQUEsRUFBQSxhQUVBLEVBQUEsT0FBQSxTQUFBLEdBQ0EsRUFBQSxPQUFBLEdBRUEsS0FBQSxFQUFBLE9BQ0EsRUFBQSxTQUVBLEVBQUEsS0FBQSxTQ2pCQSxPQUFBLFdBQUEsYUFDQSxTQUNBLFlBQ0EsV0FDQSxlQUNBLFNBQUEsRUFBQSxFQUFBLEVBQUEsR0FFQSxFQUFBLE1BQUEsU0FBQSxHQUNBLEVBQUEsTUFBQSxHQUNBLFNBQ0EsS0FDQSxXQUNBLEVBQUEsU0FBQSxvQkFDQSxFQUFBLEtBQUEsZUFDQSxRQUFBLEdBQUEsR0FDQSxFQUFBLFVBQUEsZ0JBQUEsU0NmQSxPQUFBLFdBQUEsb0JBQ0EsU0FDQSxTQUNBLGNBQ0EsZUFDQSxTQUFBLEVBQUEsRUFBQSxFQUFBLEdBRUEsRUFBQSxXQUFBLFNBQUEsR0FDQSxFQUFBLFdBQUEsR0FDQSxTQUNBLEtBQ0EsV0FDQSxFQUFBLFNBQUEscUJBQ0EsRUFBQSxVQUNBLFFBQUEsR0FBQSxHQUNBLEVBQUEsVUFBQSwwQkFBQSxNQUtBLEVBQUEsYUFBQSxTQUFBLEdBQ0EsRUFBQSxhQUFBLEdBQ0EsU0FDQSxLQUNBLFdBQ0EsRUFBQSxTQUFBLHVDQUNBLEVBQUEsVUFDQSxRQUFBLEdBQUEsR0FDQSxFQUFBLFVBQUEsdUJBQUEsU0M1QkEsT0FBQSxXQUFBLGlCQUNBLFNBQ0EsVUFDQSxXQUNBLGVBQ0EsU0FBQSxFQUFBLEVBQUEsRUFBQSxHQUVBLEVBQUEsT0FBQSxFQUNBLEVBQUEsV0FDQSxVQUFBLEVBQ0EsU0FBQSxHQUdBLEVBQUEsVUFBQSxXQUNBLEVBQUEsYUFBQSxFQUFBLFdBQ0EsU0FDQSxLQUNBLFNBQUEsR0FDQSxFQUFBLElBQUEsRUFDQSxFQUFBLE9BQUEsR0FFQSxRQUFBLEdBQUEsR0FDQSxFQUFBLFVBQUEsa0JBQUEsTUFLQSxFQUFBLFlBRUEsRUFBQSxJQUFBLDJCQUFBLFNBQUEsRUFBQSxHQUNBLEVBQUEsVUFBQSxXQUFBLEVBQ0EsRUFBQSxVQUFBLFVBQUEsRUFDQSxFQUFBLGNBR0EsRUFBQSxJQUFBLHVCQUFBLFNBQUEsRUFBQSxHQUNBLEVBQUEsVUFBQSxPQUFBLEVBQ0EsRUFBQSxVQUFBLFVBQUEsRUFDQSxFQUFBLGlCQ3RDQSxPQUFBLFdBQUEsb0JBQ0EsU0FDQSxZQUNBLFlBQ0EsaUJBQ0EsY0FDQSxlQUNBLFNBQUEsRUFBQSxFQUFBLEVBQUEsRUFDQSxFQUFBLEdBRUEsRUFBQSxTQUFBLFlBQ0EsRUFBQSxRQUNBLE9BQUEsS0FDQSxXQUFBLE1BR0EsRUFBQSxXQUFBLEVBQUEsZ0JBQ0EsRUFBQSxNQUFBLEVBQUEsV0FFQSxFQUFBLGFBQUEsU0FBQSxTQUNBLEdBQUEsT0FBQSxZQUNBLElBQUEsR0FBQSxFQUFBLE1BQUEsRUFFQSxJQUFBLEVBQUEsS0FBQSxNQUFBLGFBQUEsQ0FDQSxHQUFBLEdBQUEsR0FBQSxXQUNBLEdBQUEsT0FBQSxXQUNBLEVBQUEsT0FBQSxhQUFBLEVBQUEsT0FDQSxFQUFBLGNBQUEsS0FBQSxhQUFB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SUEsVUFBQSxTQUFBLEVBQUEsR0FFQSxHQUFBLEtBS0EsSUFKQSxHQUFBLEVBQUEsS0FBQSxtQkFDQSxFQUFBLEtBQUEsRUFBQSxLQUFBLG1CQUdBLEdBQUEsRUFBQSxLQUFBLFdBQUEsQ0FDQSxHQUFBLEdBQUEsRUFBQSxLQUFBLFVBQ0EsS0FBQSxHQUFBLEtBQUEsR0FJQSxJQUFBLEdBSEEsR0FBQSxFQUFBLEdBQ0EsRUFDQSxFQUFBLE9BQUEsRUFBQSxRQUFBLEtBQUEsR0FDQSxFQUFBLEVBQUEsRUFBQSxFQUFBLE9BQUEsSUFBQSxDQUNBLEdBQUEsR0FBQSxFQUFBLEVBQ0EsR0FBQSxLQUFBLEVBQUEsTUFBQSxJQUtBLEVBQUEsT0FBQSxJQUNBLEVBQUEsRUFBQSxRQUFBLEVBQUEsS0FBQSxTQUdBLE1BQ0EsS0FBQSxFQUNBLEtBQUEsUUFDQSxPQUFBLFlBQ0EsUUFBQSxVQ3pDQSxPQUFBLFFBQUEsV0FDQSxZQUNBLGlCQUNBLGlCQUNBLFNBQUEsRUFBQSxFQUFBLEdBVUEsUUFBQSxHQUFBLEdBQ0EsTUFBQSxHQUFBLEtBQUEsR0FHQSxRQUFBLEdBQUEsR0FDQSxNQUFBLEdBQUEsT0FBQSxHQUdBLFFBQUEsR0FBQSxFQUFBLEdBQ0EsTUFBQSxHQUFBLFFBQUEsR0FBQSxHQUFBLEdBbEJBLEdBQUEsR0FBQSxFQUFBLEVBQUEsYUFBQSxLQUFBLFFBQ0EsUUFDQSxPQUFBLE9BRUEsUUFDQSxPQUFBLFFBZ0JBLFFBQ0EsSUFBQSxFQUNBLGFBQUEsRUFDQSxLQUFBLE1DN0JBLE9BQUEsUUFBQSxrQkFDQSxZQUNBLGlCQUNBLFNBQUEsRUFBQSxHQUlBLFFBQUEsS0FDQSxNQUFBLEdBQUEsUUFIQSxHQUFBLEdBQUEsRUFBQSxFQUFBLGFBTUEsUUFDQSxjQUFBLE1DWkEsT0FBQSxRQUFBLGFBQ0EsWUFDQSxpQkFDQSxTQUFBLEVBQUEsR0FJQSxRQUFBLEtBQ0EsTUFBQSxHQUFBLFFBSEEsR0FBQSxHQUFBLEVBQUEsRUFBQSxRQU1BLFFBQ0EsU0FBQSxNQ1pBLE9BQUEsUUFBQSxlQUNBLFlBQ0EsaUJBQ0EsaUJBQ0EsU0FBQSxFQUFBLEVBQUEsR0F5QkEsUUFBQSxHQUFBLEdBQ0EsTUFBQSxHQUFBLEtBQUEsR0FHQSxRQUFBLEdBQUEsR0FDQSxNQUFBLEdBQUEsT0FBQSxHQUdBLFFBQUEsR0FBQSxHQUNBLE1BQUEsR0FBQSxLQUFBLEtBQUEsSUFHQSxRQUFBLEdBQUEsRUFBQSxHQUNBLE1BQUEsR0FBQSxRQUFBLEtBQUEsR0FBQSxHQUdBLFFBQUEsR0FBQSxHQUNBLEdBQUEsR0FBQSxFQUFBLEVBQUEsNkJBQUEsS0FBQSxRQUNBLFFBQ0EsT0FBQSxNQUNBLFFBQUEsRUFBQSxlQUlBLE9BQUEsR0FBQSxRQUFBLEdBQUEsSUFHQSxRQUFBLEdBQUEsR0FDQSxHQUFBLEdBQUEsRUFBQSxFQUFBLCtCQUFBLEtBQUEsUUFDQSxRQUNBLE9BQUEsTUFDQSxRQUFBLEVBQUEsZUFJQSxPQUFBLEdBQUEsUUFBQSxHQUFBLElBR0EsUUFBQSxHQUFBLEdBQ0EsTUFBQSxHQUFBLFFBQUEsS0FBQSxJQTlEQSxHQUFBLEdBQUEsRUFBQSxFQUFBLGtCQUFBLEtBQUEsUUFDQSxRQUNBLE9BQUEsTUFDQSxRQUFBLEVBQUEsY0FFQSxRQUNBLE9BQUEsTUFDQSxRQUFBLEVBQUEsY0FFQSxLQUNBLE9BQUEsTUFDQSxRQUFBLEVBQUEsY0FFQSxRQUNBLE9BQUEsU0FDQSxRQUFBLEVBQUEsY0FFQSxNQUNBLE9BQUEsT0FDQSxRQUFBLEVBQUEsZUE4Q0EsUUFDQSxJQUFBLEVBQ0EsV0FBQSxFQUNBLFVBQUEsRUFDQSxLQUFBLEVBQ0EsV0FBQSxFQUNBLGFBQUEsRUFDQSxTQUFBLE1DOUVBLE9BQUEsUUFBQSxZQUNBLFFBQ0EsWUFDQSxpQkFDQSxpQkFDQSxTQUFBLEVBQUEsRUFBQSxFQUFBLEdBSUEsUUFBQSxLQUNBLEdBQUEsR0FBQSxFQUFBLEVBQUEsY0FDQSxLQUNBLE9BQUEsTUFDQSxRQUFBLEVBQUEsZUFJQSxPQUFBLEdBQUEsTUFHQSxRQUFBLEdBQUEsR0FDQSxNQUFBLEdBQUEsRUFBQSxZQUNBLEtBQUEsR0FHQSxRQUFBLEdBQUEsR0FDQSxHQUFBLEdBQUEsRUFBQSxFQUFBLFNBQ0EsS0FBQSxFQVNBLE9BUEEsR0FBQSxTQUNBLEtBQ0EsU0FBQSxHQUNBLEVBQUEsU0FBQSxLQUlBLEVBR0EsUUFBQSxHQUFBLEdBQ0EsR0FBQSxHQUFBLEVBQUEsRUFBQSxjQUNBLFFBQ0EsT0FBQSxNQUNBLFFBQUEsRUFBQSxlQUlBLE9BQUEsR0FBQSxPQUFBLEdBR0EsUUFBQSxHQUFBLEdBQ0EsR0FBQSxHQUFBLEVBQUEsRUFBQSxxQkFDQSxRQUNBLE9BQUEsTUFDQSxRQUFBLEVBQUEsZUFJQSxPQUFBLEdBQUEsT0FBQSxHQUdBLFFBQUEsS0FDQSxFQUFBLGFBdkRBLEdBQUEsR0FBQSxFQUFBLE9BMERBLFFBQ0EsZUFBQSxFQUNBLFNBQUEsRUFDQSxNQUFBLEVBQ0EsS0FBQSxFQUNBLGVBQUEsRUFDQSxPQUFBIiwiZmlsZSI6ImFwcC5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcclxuXHJcbnZhciBhZHNBcHAgPSBhbmd1bGFyLm1vZHVsZSgnYWRzQXBwJywgW1xyXG4gICAgJ25nUm91dGUnLFxyXG4gICAgJ25nUmVzb3VyY2UnLFxyXG4gICAgJ0xvY2FsU3RvcmFnZU1vZHVsZScsXHJcbiAgICAndmFsaWRhdGlvbi5tYXRjaCcsXHJcbiAgICAndWkuYm9vdHN0cmFwLnBhZ2luYXRpb24nXHJcbl0pXHJcblxyXG4gICAgLmNvbmZpZyhbXHJcbiAgICAgICAgJyRyb3V0ZVByb3ZpZGVyJyxcclxuICAgICAgICAnbG9jYWxTdG9yYWdlU2VydmljZVByb3ZpZGVyJyxcclxuICAgICAgICBmdW5jdGlvbiAoJHJvdXRlUHJvdmlkZXIsIGxvY2FsU3RvcmFnZVNlcnZpY2VQcm92aWRlcikge1xyXG4gICAgICAgICAgICAkcm91dGVQcm92aWRlci53aGVuKCcvJywge1xyXG4gICAgICAgICAgICAgICAgdGl0bGU6ICdIb21lJyxcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAndGVtcGxhdGVzL2hvbWUuaHRtbCcsXHJcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnSG9tZUN0cmwnXHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgJHJvdXRlUHJvdmlkZXIud2hlbignL2xvZ2luJywge1xyXG4gICAgICAgICAgICAgICAgdGl0bGU6ICdMb2dpbicsXHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ3RlbXBsYXRlcy9sb2dpbi5odG1sJyxcclxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdMb2dpbkN0cmwnXHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgJHJvdXRlUHJvdmlkZXIud2hlbignL3JlZ2lzdGVyJywge1xyXG4gICAgICAgICAgICAgICAgdGl0bGU6ICdSZWdpc3RlcicsXHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ3RlbXBsYXRlcy9yZWdpc3Rlci5odG1sJyxcclxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdSZWdpc3RlckN0cmwnXHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgJHJvdXRlUHJvdmlkZXIud2hlbignL3VzZXIvaG9tZScsIHtcclxuICAgICAgICAgICAgICAgIHRpdGxlOiAnSG9tZScsXHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ3RlbXBsYXRlcy91c2VyLWhvbWUuaHRtbCcsXHJcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnVXNlckhvbWVDdHJsJ1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICRyb3V0ZVByb3ZpZGVyLndoZW4oJy91c2VyL2FkcycsIHtcclxuICAgICAgICAgICAgICAgIHRpdGxlOiAnTXkgYWRzJyxcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAndGVtcGxhdGVzL3VzZXItaG9tZS5odG1sJyxcclxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdVc2VyQWRzQ3RybCdcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAkcm91dGVQcm92aWRlci53aGVuKCcvdXNlci9hZHMvcHVibGlzaCcsIHtcclxuICAgICAgICAgICAgICAgIHRpdGxlOiAnUHVibGlzaCBuZXcgYWQnLFxyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICd0ZW1wbGF0ZXMvcHVibGlzaC1uZXctYWQuaHRtbCcsXHJcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnUHVibGlzaE5ld0FkQ3RybCdcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAkcm91dGVQcm92aWRlci53aGVuKCcvdXNlci9hZHMvZWRpdC86aWQnLCB7XHJcbiAgICAgICAgICAgICAgICB0aXRsZTogJ0VkaXQgYWQnLFxyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICd0ZW1wbGF0ZXMvZWRpdC1hZC5odG1sJyxcclxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdFZGl0QWRDdHJsJ1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICRyb3V0ZVByb3ZpZGVyLndoZW4oJy91c2VyL2Fkcy9kZWxldGUvOmlkJywge1xyXG4gICAgICAgICAgICAgICAgdGl0bGU6ICdEZWxldGUgYWQnLFxyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICd0ZW1wbGF0ZXMvZGVsZXRlLWFkLmh0bWwnLFxyXG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ0RlbGV0ZUFkQ3RybCdcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAkcm91dGVQcm92aWRlci53aGVuKCcvdXNlci9wcm9maWxlJywge1xyXG4gICAgICAgICAgICAgICAgdGl0bGU6ICdFZGl0IHVzZXIgcHJvZmlsZScsXHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ3RlbXBsYXRlcy9lZGl0LXByb2ZpbGUuaHRtbCcsXHJcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnRWRpdFByb2ZpbGVDdHJsJ1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICRyb3V0ZVByb3ZpZGVyLm90aGVyd2lzZSh7cmVkaXJlY3RUbzogJy8nfSk7XHJcblxyXG4gICAgICAgICAgICAvLyBXZWIgc3RvcmFnZSBzZXR0aW5nc1xyXG4gICAgICAgICAgICBsb2NhbFN0b3JhZ2VTZXJ2aWNlUHJvdmlkZXIuc2V0U3RvcmFnZVR5cGUoJ2xvY2FsU3RvcmFnZScpO1xyXG4gICAgICAgIH1dKTtcclxuXHJcbmFkc0FwcC5jb25zdGFudCgnYmFzZVNlcnZpY2VVcmwnLCAnaHR0cDovL3NvZnR1bmktYWRzLmF6dXJld2Vic2l0ZXMubmV0L2FwaS8nKTtcclxuYWRzQXBwLmNvbnN0YW50KCdwYWdlU2l6ZScsIDUpO1xyXG5cclxuYWRzQXBwLnJ1bihmdW5jdGlvbiAoJHJvb3RTY29wZSwgJGxvY2F0aW9uLCBhdXRoZW50aWNhdGlvbikge1xyXG5cclxuICAgICRyb290U2NvcGUuJG9uKCckcm91dGVDaGFuZ2VTdWNjZXNzJywgZnVuY3Rpb24gKGV2ZW50LCBjdXJyZW50LCBwcmV2aW91cykge1xyXG4gICAgICAgICRyb290U2NvcGUudGl0bGUgPSBjdXJyZW50LiQkcm91dGUudGl0bGU7XHJcbiAgICB9KTtcclxuXHJcbiAgICAkcm9vdFNjb3BlLiRvbignJGxvY2F0aW9uQ2hhbmdlU3RhcnQnLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgaWYgKCRsb2NhdGlvbi5wYXRoKCkuaW5kZXhPZignL3VzZXIvJykgIT0gLTEgJiYgIWF1dGhlbnRpY2F0aW9uLmlzTG9nZ2VkSW4oKSkge1xyXG4gICAgICAgICAgICAvLyBBdXRob3JpemF0aW9uIGNoZWNrOiBhbm9ueW1vdXMgc2l0ZSB2aXNpdG9ycyBjYW5ub3QgYWNjZXNzIHVzZXIgcm91dGVzXHJcbiAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvJyk7XHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcbn0pO1xyXG4iLCIndXNlIHN0cmljdCc7XHJcblxyXG5hZHNBcHAuY29udHJvbGxlcignRGVsZXRlQWRDdHJsJywgW1xyXG4gICAgJyRzY29wZScsXHJcbiAgICAnJGxvY2F0aW9uJyxcclxuICAgICckcm91dGVQYXJhbXMnLFxyXG4gICAgJ3VzZXJBZHNEYXRhJyxcclxuICAgICdub3RpZmljYXRpb24nLFxyXG4gICAgZnVuY3Rpb24gKCRzY29wZSwgJGxvY2F0aW9uLCAkcm91dGVQYXJhbXMsXHJcbiAgICAgICAgICAgICAgdXNlckFkc0RhdGEsIG5vdGlmaWNhdGlvbikge1xyXG5cclxuICAgICAgICAkc2NvcGUuaG9tZUxpbmsgPSAndXNlci9ob21lJztcclxuICAgICAgICB2YXIgYWRJZCA9ICRyb3V0ZVBhcmFtcy5pZDtcclxuXHJcbiAgICAgICAgdXNlckFkc0RhdGEuZ2V0QWRCeUlkKGFkSWQpXHJcbiAgICAgICAgICAgIC4kcHJvbWlzZVxyXG4gICAgICAgICAgICAudGhlbihcclxuICAgICAgICAgICAgZnVuY3Rpb24gc3VjY2VzcyhkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuYWQgPSBkYXRhO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBmdW5jdGlvbiBlcnJvcihlcnJvcikge1xyXG4gICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uLnNob3dFcnJvcignQWR2ZXJ0aXNlbWVudCBjYW4gbm90IGJlIGRlbGV0ZWQnLCBlcnJvcik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICApO1xyXG5cclxuICAgICAgICAkc2NvcGUuZGVsZXRlID0gZnVuY3Rpb24gKGlkKSB7XHJcbiAgICAgICAgICAgIHVzZXJBZHNEYXRhLmRlbGV0ZShpZClcclxuICAgICAgICAgICAgICAgIC4kcHJvbWlzZVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oXHJcbiAgICAgICAgICAgICAgICBmdW5jdGlvbiBzdWNjZXNzKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIG5vdGlmaWNhdGlvbi5zaG93SW5mbygnQWR2ZXJ0aXNlbWVudCBkZWxldGVkJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy91c2VyL2FkcycpO1xyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGVycm9yKGVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uLnNob3dFcnJvcignQWR2ZXJ0aXNlbWVudCBjYW4gbm90IGJlIGRlbGV0ZWQnLCBlcnJvcik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgIH1dKTtcclxuIiwiJ3VzZSBzdHJpY3QnO1xyXG5cclxuYWRzQXBwLmNvbnRyb2xsZXIoJ0VkaXRBZEN0cmwnLCBbXHJcbiAgICAnJHNjb3BlJyxcclxuICAgICckcm91dGVQYXJhbXMnLFxyXG4gICAgJyRsb2NhdGlvbicsXHJcbiAgICAndG93bnNEYXRhJyxcclxuICAgICdjYXRlZ29yaWVzRGF0YScsXHJcbiAgICAndXNlckFkc0RhdGEnLFxyXG4gICAgJ25vdGlmaWNhdGlvbicsXHJcbiAgICBmdW5jdGlvbiAoJHNjb3BlLCAkcm91dGVQYXJhbXMsICRsb2NhdGlvbiwgdG93bnNEYXRhLCBjYXRlZ29yaWVzRGF0YSxcclxuICAgICAgICAgICAgICB1c2VyQWRzRGF0YSwgbm90aWZpY2F0aW9uKSB7XHJcblxyXG4gICAgICAgICRzY29wZS5ob21lTGluayA9ICd1c2VyL2hvbWUnO1xyXG4gICAgICAgIHZhciBhZElkID0gJHJvdXRlUGFyYW1zLmlkO1xyXG4gICAgICAgIHZhciBjaGFuZ2VJbWFnZSA9IGZhbHNlO1xyXG5cclxuICAgICAgICB1c2VyQWRzRGF0YS5nZXRBZEJ5SWQoYWRJZClcclxuICAgICAgICAgICAgLiRwcm9taXNlXHJcbiAgICAgICAgICAgIC50aGVuKFxyXG4gICAgICAgICAgICBmdW5jdGlvbiBzdWNjZXNzKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5hZERhdGEgPSBkYXRhO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBmdW5jdGlvbiBlcnJvcihlcnJvcikge1xyXG4gICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uLnNob3dFcnJvcignQWR2ZXJ0aXNlbWVudCBjYW4gbm90IGJlIGVkaXRlZCcsIGVycm9yKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICk7XHJcblxyXG4gICAgICAgICRzY29wZS5jYXRlZ29yaWVzID0gY2F0ZWdvcmllc0RhdGEuZ2V0Q2F0ZWdvcmllcygpO1xyXG4gICAgICAgICRzY29wZS50b3ducyA9IHRvd25zRGF0YS5nZXRUb3ducygpO1xyXG5cclxuICAgICAgICAkc2NvcGUuZGVsZXRlSW1hZ2UgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGRlbGV0ZSAkc2NvcGUuYWREYXRhLmltYWdlRGF0YVVybDtcclxuICAgICAgICAgICAgY2hhbmdlSW1hZ2UgPSB0cnVlO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgICRzY29wZS5maWxlU2VsZWN0ZWQgPSBmdW5jdGlvbiAoZmlsZUlucHV0RmllbGQpIHtcclxuICAgICAgICAgICAgZGVsZXRlICRzY29wZS5hZERhdGEuaW1hZ2VEYXRhVXJsO1xyXG4gICAgICAgICAgICB2YXIgZmlsZSA9IGZpbGVJbnB1dEZpZWxkLmZpbGVzWzBdO1xyXG5cclxuICAgICAgICAgICAgaWYgKGZpbGUudHlwZS5tYXRjaCgvaW1hZ2VcXC8uKi8pKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTtcclxuICAgICAgICAgICAgICAgIHJlYWRlci5vbmxvYWQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmFkRGF0YS5pbWFnZURhdGFVcmwgPSByZWFkZXIucmVzdWx0O1xyXG4gICAgICAgICAgICAgICAgICAgIGNoYW5nZUltYWdlID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAkKFwiLmltYWdlLWJveFwiKS5odG1sKFwiPGltZyBzcmM9J1wiICsgcmVhZGVyLnJlc3VsdCArIFwiJz5cIik7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIHJlYWRlci5yZWFkQXNEYXRhVVJMKGZpbGUpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgJChcIi5pbWFnZS1ib3hcIikuaHRtbChcIjxwPkZpbGUgdHlwZSBub3Qgc3VwcG9ydGVkITwvcD5cIik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuXHJcbiAgICAgICAgJHNjb3BlLmVkaXQgPSBmdW5jdGlvbiAoYWREYXRhKSB7XHJcbiAgICAgICAgICAgIGFkRGF0YS5jaGFuZ2VJbWFnZSA9IGNoYW5nZUltYWdlO1xyXG5cclxuICAgICAgICAgICAgdXNlckFkc0RhdGEuZWRpdChhZElkLCBhZERhdGEpXHJcbiAgICAgICAgICAgICAgICAuJHByb21pc2VcclxuICAgICAgICAgICAgICAgIC50aGVuKFxyXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gc3VjY2VzcygpIHtcclxuICAgICAgICAgICAgICAgICAgICBub3RpZmljYXRpb24uc2hvd0luZm8oXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICdBZHZlcnRpc2VtZW50IGVkaXRlZC4gRG9uXFwndCBmb3JnZXQgdG8gc3VibWl0IGl0IGZvciBwdWJsaXNoaW5nLicpO1xyXG4gICAgICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvdXNlci9hZHMnKTtcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBmdW5jdGlvbiBlcnJvcihlcnJvcikge1xyXG4gICAgICAgICAgICAgICAgICAgIG5vdGlmaWNhdGlvbi5zaG93RXJyb3IoJ0VkaXRpbmcgZmFpbGVkJywgZXJyb3IpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgfV0pO1xyXG4iLCIndXNlIHN0cmljdCc7XHJcblxyXG5hZHNBcHAuY29udHJvbGxlcignRWRpdFByb2ZpbGVDdHJsJywgW1xyXG4gICAgJyRzY29wZScsXHJcbiAgICAnJGxvY2F0aW9uJyxcclxuICAgICd0b3duc0RhdGEnLFxyXG4gICAgJ3VzZXJEYXRhJyxcclxuICAgICdub3RpZmljYXRpb24nLFxyXG4gICAgZnVuY3Rpb24gKCRzY29wZSwgJGxvY2F0aW9uLCB0b3duc0RhdGEsIHVzZXJEYXRhLCBub3RpZmljYXRpb24pIHtcclxuXHJcbiAgICAgICAgJHNjb3BlLmhvbWVMaW5rID0gJ3VzZXIvaG9tZSc7XHJcbiAgICAgICAgJHNjb3BlLnBhc3MgPSB7XHJcbiAgICAgICAgICAgIG9sZFBhc3N3b3JkOiBudWxsLFxyXG4gICAgICAgICAgICBuZXdQYXNzd29yZDogbnVsbCxcclxuICAgICAgICAgICAgY29uZmlybVBhc3N3b3JkOiBudWxsXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgJHNjb3BlLnRvd25zID0gdG93bnNEYXRhLmdldFRvd25zKCk7XHJcbiAgICAgICAgJHNjb3BlLnVzZXIgPSB1c2VyRGF0YS5nZXRVc2VyUHJvZmlsZSgpO1xyXG5cclxuICAgICAgICAkc2NvcGUuZWRpdCA9IGZ1bmN0aW9uICh1c2VyKSB7XHJcbiAgICAgICAgICAgIHVzZXJEYXRhLmVkaXQodXNlcilcclxuICAgICAgICAgICAgICAgIC4kcHJvbWlzZVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oXHJcbiAgICAgICAgICAgICAgICBmdW5jdGlvbiBzdWNjZXNzKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIG5vdGlmaWNhdGlvbi5zaG93SW5mbygnVXNlciBwcm9maWxlIHN1Y2Nlc3NmdWxseSB1cGRhdGVkLicpO1xyXG4gICAgICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvdXNlci9ob21lJyk7XHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gZXJyb3IoZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgICAgICBub3RpZmljYXRpb24uc2hvd0Vycm9yKCdVc2VyIHByb2ZpbGUgaXMgbm90IHVwZGF0ZWQuJywgZXJyb3IpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgICRzY29wZS5jaGFuZ2VQYXNzd29yZCA9IGZ1bmN0aW9uIChwYXNzKSB7XHJcbiAgICAgICAgICAgIHVzZXJEYXRhLmNoYW5nZVBhc3N3b3JkKHBhc3MpXHJcbiAgICAgICAgICAgICAgICAuJHByb21pc2VcclxuICAgICAgICAgICAgICAgIC50aGVuKFxyXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gc3VjY2VzcygpIHtcclxuICAgICAgICAgICAgICAgICAgICBub3RpZmljYXRpb24uc2hvd0luZm8oJ1Bhc3N3b3JkIHN1Y2Nlc3NmdWxseSB1cGRhdGVkLicpO1xyXG4gICAgICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvdXNlci9ob21lJyk7XHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gZXJyb3IoZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgICAgICBub3RpZmljYXRpb24uc2hvd0Vycm9yKCdQYXNzd29yZCBpcyBub3QgdXBkYXRlZC4nLCBlcnJvcik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgfVxyXG4gICAgfV0pO1xyXG4iLCIndXNlIHN0cmljdCc7XHJcblxyXG5hZHNBcHAuY29udHJvbGxlcignSG9tZUN0cmwnLCBbXHJcbiAgICAnJHNjb3BlJyxcclxuICAgICckbG9jYXRpb24nLFxyXG4gICAgJyRyb3V0ZScsXHJcbiAgICAndXNlckRhdGEnLFxyXG4gICAgJ2F1dGhlbnRpY2F0aW9uJyxcclxuICAgIGZ1bmN0aW9uICgkc2NvcGUsICRsb2NhdGlvbiwgJHJvdXRlLCB1c2VyRGF0YSwgYXV0aGVudGljYXRpb24pIHtcclxuXHJcbiAgICAgICAgJHNjb3BlLmF1dGhlbnRpY2F0aW9uID0gYXV0aGVudGljYXRpb247XHJcbiAgICAgICAgJHNjb3BlLmlzTG9nZ2VkSW4gPSBhdXRoZW50aWNhdGlvbi5pc0xvZ2dlZEluKCk7XHJcblxyXG4gICAgICAgICRzY29wZS5sb2dvdXQgPSBmdW5jdGlvbiAodXNlcikge1xyXG4gICAgICAgICAgICB1c2VyRGF0YS5sb2dvdXQodXNlcik7XHJcblxyXG4gICAgICAgICAgICBpZiAoJGxvY2F0aW9uLiQkcGF0aCA9PSAnLycpIHtcclxuICAgICAgICAgICAgICAgICRyb3V0ZS5yZWxvYWQoKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvJyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XSk7XHJcbiIsIid1c2Ugc3RyaWN0JztcclxuXHJcbmFkc0FwcC5jb250cm9sbGVyKCdMb2dpbkN0cmwnLCBbXHJcbiAgICAnJHNjb3BlJyxcclxuICAgICckbG9jYXRpb24nLFxyXG4gICAgJ3VzZXJEYXRhJyxcclxuICAgICdub3RpZmljYXRpb24nLFxyXG4gICAgZnVuY3Rpb24gKCRzY29wZSwgJGxvY2F0aW9uLCB1c2VyRGF0YSwgbm90aWZpY2F0aW9uKSB7XHJcblxyXG4gICAgICAgICRzY29wZS5sb2dpbiA9IGZ1bmN0aW9uICh1c2VyKSB7XHJcbiAgICAgICAgICAgIHVzZXJEYXRhLmxvZ2luKHVzZXIpXHJcbiAgICAgICAgICAgICAgICAuJHByb21pc2VcclxuICAgICAgICAgICAgICAgIC50aGVuKFxyXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gc3VjY2VzcygpIHtcclxuICAgICAgICAgICAgICAgICAgICBub3RpZmljYXRpb24uc2hvd0luZm8oJ0xvZ2luIHN1Y2Nlc3NmdWwnKTtcclxuICAgICAgICAgICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnL3VzZXIvaG9tZScpO1xyXG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gZXJyb3IoZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgICAgICBub3RpZmljYXRpb24uc2hvd0Vycm9yKCdJbnZhbGlkIGxvZ2luJywgZXJyb3IpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgIH1cclxuICAgIH1dKTtcclxuIiwiJ3VzZSBzdHJpY3QnO1xyXG5cclxuYWRzQXBwLmNvbnRyb2xsZXIoJ01hbmFnZUFkTWVudUN0cmwnLCBbXHJcbiAgICAnJHNjb3BlJyxcclxuICAgICckcm91dGUnLFxyXG4gICAgJ3VzZXJBZHNEYXRhJyxcclxuICAgICdub3RpZmljYXRpb24nLFxyXG4gICAgZnVuY3Rpb24gKCRzY29wZSwgJHJvdXRlLCB1c2VyQWRzRGF0YSwgbm90aWZpY2F0aW9uKSB7XHJcblxyXG4gICAgICAgICRzY29wZS5kZWFjdGl2YXRlID0gZnVuY3Rpb24gKGFkSWQpIHtcclxuICAgICAgICAgICAgdXNlckFkc0RhdGEuZGVhY3RpdmF0ZShhZElkKVxyXG4gICAgICAgICAgICAgICAgLiRwcm9taXNlXHJcbiAgICAgICAgICAgICAgICAudGhlbihcclxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIHN1Y2Nlc3MoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uLnNob3dJbmZvKCdBZCBpcyBkZWFjdGl2YXRlZCcpO1xyXG4gICAgICAgICAgICAgICAgICAgICRyb3V0ZS5yZWxvYWQoKTtcclxuICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIGVycm9yKGVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uLnNob3dFcnJvcignQ2FuXFwndCBkZWFjdGl2YXRlIHRoZSBhZCcsIGVycm9yKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAkc2NvcGUucHVibGlzaEFnYWluID0gZnVuY3Rpb24gKGFkSWQpIHtcclxuICAgICAgICAgICAgdXNlckFkc0RhdGEucHVibGlzaEFnYWluKGFkSWQpXHJcbiAgICAgICAgICAgICAgICAuJHByb21pc2VcclxuICAgICAgICAgICAgICAgIC50aGVuKFxyXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gc3VjY2VzcygpIHtcclxuICAgICAgICAgICAgICAgICAgICBub3RpZmljYXRpb24uc2hvd0luZm8oJ0FkIGlzIHB1Ymxpc2hlZCBhZ2FpbiBmb3IgYXBwcm92YWwuJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgJHJvdXRlLnJlbG9hZCgpO1xyXG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gZXJyb3IoZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgICAgICBub3RpZmljYXRpb24uc2hvd0Vycm9yKCdDYW5cXCd0IHB1Ymxpc2ggdGhlIGFkJywgZXJyb3IpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICB9XSk7XHJcbiIsIid1c2Ugc3RyaWN0JztcclxuXHJcbmFkc0FwcC5jb250cm9sbGVyKCdQdWJsaWNBZHNDdHJsJywgW1xyXG4gICAgJyRzY29wZScsXHJcbiAgICAnYWRzRGF0YScsXHJcbiAgICAncGFnZVNpemUnLFxyXG4gICAgJ25vdGlmaWNhdGlvbicsXHJcbiAgICBmdW5jdGlvbiAoJHNjb3BlLCBhZHNEYXRhLCBwYWdlU2l6ZSwgbm90aWZpY2F0aW9uKSB7XHJcblxyXG4gICAgICAgICRzY29wZS5yZWFkeSA9IGZhbHNlO1xyXG4gICAgICAgICRzY29wZS5hZHNQYXJhbXMgPSB7XHJcbiAgICAgICAgICAgIHN0YXJ0UGFnZTogMSxcclxuICAgICAgICAgICAgcGFnZVNpemU6IHBhZ2VTaXplXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgJHNjb3BlLnJlbG9hZEFkcyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgYWRzRGF0YS5nZXRQdWJsaWNBZHMoJHNjb3BlLmFkc1BhcmFtcylcclxuICAgICAgICAgICAgICAgIC4kcHJvbWlzZVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oXHJcbiAgICAgICAgICAgICAgICBmdW5jdGlvbiBzdWNjZXNzKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuYWRzID0gZGF0YTtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUucmVhZHkgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGVycm9yKGVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uLnNob3dFcnJvcignQ2Fubm90IGxvYWQgYWRzJywgZXJyb3IpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgICRzY29wZS5yZWxvYWRBZHMoKTtcclxuXHJcbiAgICAgICAgJHNjb3BlLiRvbignY2F0ZWdvcnlTZWxlY3Rpb25DaGFuZ2VkJywgZnVuY3Rpb24gKGV2ZW50LCBzZWxlY3RlZENhdGVnb3J5SWQpIHtcclxuICAgICAgICAgICAgJHNjb3BlLmFkc1BhcmFtcy5jYXRlZ29yeUlkID0gc2VsZWN0ZWRDYXRlZ29yeUlkO1xyXG4gICAgICAgICAgICAkc2NvcGUuYWRzUGFyYW1zLnN0YXJ0UGFnZSA9IDE7XHJcbiAgICAgICAgICAgICRzY29wZS5yZWxvYWRBZHMoKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgJHNjb3BlLiRvbigndG93blNlbGVjdGlvbkNoYW5nZWQnLCBmdW5jdGlvbiAoZXZlbnQsIHNlbGVjdGVkVG93bklkKSB7XHJcbiAgICAgICAgICAgICRzY29wZS5hZHNQYXJhbXMudG93bklkID0gc2VsZWN0ZWRUb3duSWQ7XHJcbiAgICAgICAgICAgICRzY29wZS5hZHNQYXJhbXMuc3RhcnRQYWdlID0gMTtcclxuICAgICAgICAgICAgJHNjb3BlLnJlbG9hZEFkcygpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfV0pO1xyXG4iLCIndXNlIHN0cmljdCc7XHJcblxyXG5hZHNBcHAuY29udHJvbGxlcignUHVibGlzaE5ld0FkQ3RybCcsIFtcclxuICAgICckc2NvcGUnLFxyXG4gICAgJyRsb2NhdGlvbicsXHJcbiAgICAndG93bnNEYXRhJyxcclxuICAgICdjYXRlZ29yaWVzRGF0YScsXHJcbiAgICAndXNlckFkc0RhdGEnLFxyXG4gICAgJ25vdGlmaWNhdGlvbicsXHJcbiAgICBmdW5jdGlvbiAoJHNjb3BlLCAkbG9jYXRpb24sIHRvd25zRGF0YSwgY2F0ZWdvcmllc0RhdGEsXHJcbiAgICAgICAgICAgICAgdXNlckFkc0RhdGEsIG5vdGlmaWNhdGlvbikge1xyXG5cclxuICAgICAgICAkc2NvcGUuaG9tZUxpbmsgPSAndXNlci9ob21lJztcclxuICAgICAgICAkc2NvcGUuYWREYXRhID0ge1xyXG4gICAgICAgICAgICB0b3duSWQ6IG51bGwsXHJcbiAgICAgICAgICAgIGNhdGVnb3J5SWQ6IG51bGxcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAkc2NvcGUuY2F0ZWdvcmllcyA9IGNhdGVnb3JpZXNEYXRhLmdldENhdGVnb3JpZXMoKTtcclxuICAgICAgICAkc2NvcGUudG93bnMgPSB0b3duc0RhdGEuZ2V0VG93bnMoKTtcclxuXHJcbiAgICAgICAgJHNjb3BlLmZpbGVTZWxlY3RlZCA9IGZ1bmN0aW9uIChmaWxlSW5wdXRGaWVsZCkge1xyXG4gICAgICAgICAgICBkZWxldGUgJHNjb3BlLmFkRGF0YS5pbWFnZURhdGFVcmw7XHJcbiAgICAgICAgICAgIHZhciBmaWxlID0gZmlsZUlucHV0RmllbGQuZmlsZXNbMF07XHJcblxyXG4gICAgICAgICAgICBpZiAoZmlsZS50eXBlLm1hdGNoKC9pbWFnZVxcLy4qLykpIHtcclxuICAgICAgICAgICAgICAgIHZhciByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpO1xyXG4gICAgICAgICAgICAgICAgcmVhZGVyLm9ubG9hZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuYWREYXRhLmltYWdlRGF0YVVybCA9IHJlYWRlci5yZXN1bHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgJChcIi5pbWFnZS1ib3hcIikuaHRtbChcIjxpbWcgc3JjPSdcIiArIHJlYWRlci5yZXN1bHQgKyBcIic+XCIpO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICByZWFkZXIucmVhZEFzRGF0YVVSTChmaWxlKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICQoXCIuaW1hZ2UtYm94XCIpLmh0bWwoXCI8cD5GaWxlIHR5cGUgbm90IHN1cHBvcnRlZCE8L3A+XCIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcblxyXG4gICAgICAgICRzY29wZS5wdWJsaXNoQWQgPSBmdW5jdGlvbiAoYWREYXRhKSB7XHJcbiAgICAgICAgICAgIGlmIChhZERhdGEuaW1hZ2VEYXRhVXJsID09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIGFkRGF0YS5pbWFnZURhdGFVcmwgPSAnJztcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdXNlckFkc0RhdGEuYWRkKGFkRGF0YSlcclxuICAgICAgICAgICAgICAgIC4kcHJvbWlzZVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oXHJcbiAgICAgICAgICAgICAgICBmdW5jdGlvbiBzdWNjZXNzKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIG5vdGlmaWNhdGlvbi5zaG93SW5mbyhcclxuICAgICAgICAgICAgICAgICAgICAgICAgJ0FkdmVydGlzZW1lbnQgc3VibWl0dGVkIGRvciBhcHByb3ZhbC4gT25jZSBhcHByb3ZlZCwgaXQgd2lsbCBiZSBwdWJsaXNoZWQuJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy91c2VyL2FkcycpO1xyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGVycm9yKGVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uLnNob3dFcnJvcignUHVibGlzaGluZyBmYWlsZWQnLCBlcnJvcik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgfVxyXG4gICAgfV0pO1xyXG4iLCIndXNlIHN0cmljdCc7XHJcblxyXG5hZHNBcHAuY29udHJvbGxlcignUmVnaXN0ZXJDdHJsJywgW1xyXG4gICAgJyRzY29wZScsXHJcbiAgICAnJGxvY2F0aW9uJyxcclxuICAgICd0b3duc0RhdGEnLFxyXG4gICAgJ3VzZXJEYXRhJyxcclxuICAgICdub3RpZmljYXRpb24nLFxyXG4gICAgZnVuY3Rpb24gKCRzY29wZSwgJGxvY2F0aW9uLCB0b3duc0RhdGEsIHVzZXJEYXRhLCBub3RpZmljYXRpb24pIHtcclxuXHJcbiAgICAgICAgJHNjb3BlLnRvd25zID0gdG93bnNEYXRhLmdldFRvd25zKCk7XHJcblxyXG4gICAgICAgICRzY29wZS5yZWdpc3RlciA9IGZ1bmN0aW9uICh1c2VyKSB7XHJcbiAgICAgICAgICAgIHVzZXJEYXRhLnJlZ2lzdGVyKHVzZXIpXHJcbiAgICAgICAgICAgICAgICAuJHByb21pc2VcclxuICAgICAgICAgICAgICAgIC50aGVuKFxyXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gc3VjY2VzcygpIHtcclxuICAgICAgICAgICAgICAgICAgICBub3RpZmljYXRpb24uc2hvd0luZm8oJ1VzZXIgYWNjb3VudCBjcmVhdGVkLiBQbGVhc2UgbG9nIGluLicpO1xyXG4gICAgICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvbG9naW4nKTtcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBmdW5jdGlvbiBlcnJvcihlcnJvcikge1xyXG4gICAgICAgICAgICAgICAgICAgIG5vdGlmaWNhdGlvbi5zaG93RXJyb3IoJ0ludmFsaWQgcmVnaXN0cmF0aW9uJywgZXJyb3IpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgIH1cclxuICAgIH1dKTtcclxuIiwiJ3VzZSBzdHJpY3QnO1xyXG5cclxuYWRzQXBwLmNvbnRyb2xsZXIoJ1JpZ2h0U2lkZWJhckN0cmwnLCBbXHJcbiAgICAnJHNjb3BlJyxcclxuICAgICckcm9vdFNjb3BlJyxcclxuICAgICd0b3duc0RhdGEnLFxyXG4gICAgJ2NhdGVnb3JpZXNEYXRhJyxcclxuICAgIGZ1bmN0aW9uICgkc2NvcGUsICRyb290U2NvcGUsIHRvd25zRGF0YSwgY2F0ZWdvcmllc0RhdGEpIHtcclxuXHJcbiAgICAgICAgJHNjb3BlLmNhdGVnb3JpZXMgPSBjYXRlZ29yaWVzRGF0YS5nZXRDYXRlZ29yaWVzKCk7XHJcbiAgICAgICAgJHNjb3BlLnRvd25zID0gdG93bnNEYXRhLmdldFRvd25zKCk7XHJcblxyXG4gICAgICAgICRzY29wZS5jYXRlZ29yeUNsaWNrZWQgPSBmdW5jdGlvbiAoY2xpY2tlZENhdGVnb3J5SWQpIHtcclxuICAgICAgICAgICAgJHNjb3BlLnNlbGVjdGVkQ2F0ZWdvcnlJZCA9IGNsaWNrZWRDYXRlZ29yeUlkO1xyXG4gICAgICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ2NhdGVnb3J5U2VsZWN0aW9uQ2hhbmdlZCcsIGNsaWNrZWRDYXRlZ29yeUlkKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAkc2NvcGUudG93bkNsaWNrZWQgPSBmdW5jdGlvbiAoY2xpY2tlZFRvd25JZCkge1xyXG4gICAgICAgICAgICAkc2NvcGUuc2VsZWN0ZWRUb3duSWQgPSBjbGlja2VkVG93bklkO1xyXG4gICAgICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ3Rvd25TZWxlY3Rpb25DaGFuZ2VkJywgY2xpY2tlZFRvd25JZCk7XHJcbiAgICAgICAgfTtcclxuICAgIH1dKTtcclxuIiwiJ3VzZSBzdHJpY3QnO1xyXG5cclxuYWRzQXBwLmNvbnRyb2xsZXIoJ1N0YXR1c0ZpbHRlckN0cmwnLCBbXHJcbiAgICAnJHNjb3BlJyxcclxuICAgICckcm9vdFNjb3BlJyxcclxuICAgIGZ1bmN0aW9uICgkc2NvcGUsICRyb290U2NvcGUpIHtcclxuXHJcbiAgICAgICAgJHNjb3BlLnN0YXR1c0NsaWNrZWQgPSBmdW5jdGlvbiAoc2VsZWN0ZWRTdGF0dXNJZCkge1xyXG4gICAgICAgICAgICAkc2NvcGUuc2VsZWN0ZWRTdGF0dXNJZCA9IHNlbGVjdGVkU3RhdHVzSWQ7XHJcbiAgICAgICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnc3RhdHVzU2VsZWN0aW9uQ2hhbmdlZCcsIHNlbGVjdGVkU3RhdHVzSWQpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgfV0pO1xyXG4iLCIndXNlIHN0cmljdCc7XHJcblxyXG5hZHNBcHAuY29udHJvbGxlcignVXNlckFkc0N0cmwnLCBbXHJcbiAgICAnJHNjb3BlJyxcclxuICAgICckcm91dGUnLFxyXG4gICAgJ2Fkc0RhdGEnLFxyXG4gICAgJ3VzZXJBZHNEYXRhJyxcclxuICAgICd1c2VyRGF0YScsXHJcbiAgICAncGFnZVNpemUnLFxyXG4gICAgJ25vdGlmaWNhdGlvbicsXHJcbiAgICBmdW5jdGlvbiAoJHNjb3BlLCAkcm91dGUsIGFkc0RhdGEsIHVzZXJBZHNEYXRhLCB1c2VyRGF0YSwgcGFnZVNpemUsIG5vdGlmaWNhdGlvbikge1xyXG5cclxuICAgICAgICAkc2NvcGUuaG9tZUxpbmsgPSAndXNlci9ob21lJztcclxuICAgICAgICAkc2NvcGUuaW5NeUFkcyA9IHRydWU7XHJcbiAgICAgICAgJHNjb3BlLnJlYWR5ID0gZmFsc2U7XHJcbiAgICAgICAgJHNjb3BlLmFkc1BhcmFtcyA9IHtcclxuICAgICAgICAgICAgJ3N0YXJ0UGFnZSc6IDEsXHJcbiAgICAgICAgICAgICdwYWdlU2l6ZSc6IHBhZ2VTaXplXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgJHNjb3BlLnJlbG9hZEFkcyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdXNlckFkc0RhdGEuZ2V0VXNlckFkcygkc2NvcGUuYWRzUGFyYW1zKVxyXG4gICAgICAgICAgICAgICAgLiRwcm9taXNlXHJcbiAgICAgICAgICAgICAgICAudGhlbihcclxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIHN1Y2Nlc3MoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5hZHMgPSBkYXRhO1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5yZWFkeSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gZXJyb3IoZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgICAgICBub3RpZmljYXRpb24uc2hvd0Vycm9yKCdDYW5ub3QgbG9hZCBhZHMnLCBlcnJvcik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgJHNjb3BlLnJlbG9hZEFkcygpO1xyXG5cclxuICAgICAgICAkc2NvcGUuJG9uKCdjYXRlZ29yeVNlbGVjdGlvbkNoYW5nZWQnLCBmdW5jdGlvbiAoZXZlbnQsIHNlbGVjdGVkQ2F0ZWdvcnlJZCkge1xyXG4gICAgICAgICAgICAkc2NvcGUuYWRzUGFyYW1zLmNhdGVnb3J5SWQgPSBzZWxlY3RlZENhdGVnb3J5SWQ7XHJcbiAgICAgICAgICAgICRzY29wZS5hZHNQYXJhbXMuc3RhcnRQYWdlID0gMTtcclxuICAgICAgICAgICAgJHNjb3BlLnJlbG9hZEFkcygpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICAkc2NvcGUuJG9uKCd0b3duU2VsZWN0aW9uQ2hhbmdlZCcsIGZ1bmN0aW9uIChldmVudCwgc2VsZWN0ZWRUb3duSWQpIHtcclxuICAgICAgICAgICAgJHNjb3BlLmFkc1BhcmFtcy50b3duSWQgPSBzZWxlY3RlZFRvd25JZDtcclxuICAgICAgICAgICAgJHNjb3BlLmFkc1BhcmFtcy5zdGFydFBhZ2UgPSAxO1xyXG4gICAgICAgICAgICAkc2NvcGUucmVsb2FkQWRzKCk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICRzY29wZS4kb24oJ3N0YXR1c1NlbGVjdGlvbkNoYW5nZWQnLCBmdW5jdGlvbiAoZXZlbnQsIHNlbGVjdGVkU3RhdHVzSWQpIHtcclxuICAgICAgICAgICAgJHNjb3BlLmFkc1BhcmFtcy5zdGF0dXMgPSBzZWxlY3RlZFN0YXR1c0lkO1xyXG4gICAgICAgICAgICAkc2NvcGUuYWRzUGFyYW1zLnN0YXJ0UGFnZSA9IDE7XHJcbiAgICAgICAgICAgICRzY29wZS5yZWxvYWRBZHMoKTtcclxuICAgICAgICB9KTtcclxuICAgIH1dKTtcclxuIiwiJ3VzZSBzdHJpY3QnO1xyXG5cclxuYWRzQXBwLmNvbnRyb2xsZXIoJ1VzZXJIb21lQ3RybCcsIFtcclxuICAgICckc2NvcGUnLFxyXG4gICAgJyRsb2NhdGlvbicsXHJcbiAgICAnJHJvdXRlJyxcclxuICAgICd1c2VyRGF0YScsXHJcbiAgICAnYXV0aGVudGljYXRpb24nLFxyXG4gICAgZnVuY3Rpb24gKCRzY29wZSwgJGxvY2F0aW9uLCAkcm91dGUsIHVzZXJEYXRhLCBhdXRoZW50aWNhdGlvbikge1xyXG5cclxuICAgICAgICAkc2NvcGUuaG9tZUxpbmsgPSAndXNlci9ob21lJztcclxuICAgICAgICAkc2NvcGUuYXV0aGVudGljYXRpb24gPSBhdXRoZW50aWNhdGlvbjtcclxuICAgICAgICAkc2NvcGUuaXNMb2dnZWRJbiA9IGF1dGhlbnRpY2F0aW9uLmlzTG9nZ2VkSW4oKTtcclxuICAgICAgICAkc2NvcGUuaW5Ib21lID0gJGxvY2F0aW9uLiQkcGF0aCA9PSAnL3VzZXIvaG9tZSc7XHJcbiAgICAgICAgJHNjb3BlLmluTXlBZHMgPSAkbG9jYXRpb24uJCRwYXRoID09ICcvdXNlci9hZHMnO1xyXG4gICAgICAgICRzY29wZS5pblB1Ymxpc2hOZXcgPSAkbG9jYXRpb24uJCRwYXRoID09ICcvdXNlci9hZHMvcHVibGlzaCc7XHJcblxyXG4gICAgICAgICRzY29wZS5sb2dvdXQgPSBmdW5jdGlvbiAodXNlcikge1xyXG4gICAgICAgICAgICB1c2VyRGF0YS5sb2dvdXQodXNlcik7XHJcblxyXG4gICAgICAgICAgICBpZiAoJGxvY2F0aW9uLiQkcGF0aCA9PSAnLycpIHtcclxuICAgICAgICAgICAgICAgICRyb3V0ZS5yZWxvYWQoKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvJyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XSk7XHJcbiIsIid1c2Ugc3RyaWN0JztcclxuXHJcbmFkc0FwcC5kaXJlY3RpdmUoJ2NhdGVnb3JpZXMnLCBmdW5jdGlvbiAoKSB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIGNvbnRyb2xsZXI6ICdSaWdodFNpZGViYXJDdHJsJyxcclxuICAgICAgICByZXN0cmljdDogJ0UnLFxyXG4gICAgICAgIHRlbXBsYXRlVXJsOiAndGVtcGxhdGVzL2RpcmVjdGl2ZXMvY2F0ZWdvcmllcy5odG1sJyxcclxuICAgICAgICByZXBsYWNlOiB0cnVlXHJcbiAgICB9XHJcbn0pO1xyXG4iLCIndXNlIHN0cmljdCc7XHJcblxyXG5hZHNBcHAuZGlyZWN0aXZlKCdjaGFuZ2VUaXRsZU9uQmx1cicsW1xyXG4gICAgZnVuY3Rpb24gKCkge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICByZXN0cmljdDogJ0EnLFxyXG4gICAgICAgIHNjb3BlOiB0cnVlLFxyXG4gICAgICAgIGxpbms6IGZ1bmN0aW9uIChzY29wZSkge1xyXG4gICAgICAgICAgICAgICAgZG9jdW1lbnQudGl0bGUgPSAnQWRzIC0gJyArIHNjb3BlLnRpdGxlO1xyXG5cclxuICAgICAgICAgICAgJCh3aW5kb3cpLmZvY3VzKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIGRvY3VtZW50LnRpdGxlID0gJ0FkcyAtICcgKyBzY29wZS50aXRsZTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAkKHdpbmRvdykuYmx1cihmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICBkb2N1bWVudC50aXRsZSA9ICdJIG1pc3MgeW91Li4nO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1dKTtcclxuIiwiJ3VzZSBzdHJpY3QnO1xyXG5cclxuYWRzQXBwLmRpcmVjdGl2ZSgnbG9nZ2VkSW5TaWRlYmFyJywgZnVuY3Rpb24gKCkge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICBjb250cm9sbGVyOiAnSG9tZUN0cmwnLFxyXG4gICAgICAgIHJlc3RyaWN0OiAnRScsXHJcbiAgICAgICAgdGVtcGxhdGVVcmw6ICd0ZW1wbGF0ZXMvZGlyZWN0aXZlcy9sb2dnZWQtaW4tc2lkZWJhci5odG1sJyxcclxuICAgICAgICByZXBsYWNlOiB0cnVlXHJcbiAgICB9XHJcbn0pO1xyXG4iLCIndXNlIHN0cmljdCc7XHJcblxyXG5hZHNBcHAuZGlyZWN0aXZlKCdtYW5hZ2VBZE1lbnUnLCBmdW5jdGlvbiAoKSB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIGNvbnRyb2xsZXI6ICdNYW5hZ2VBZE1lbnVDdHJsJyxcclxuICAgICAgICByZXN0cmljdDogJ0UnLFxyXG4gICAgICAgIHRlbXBsYXRlVXJsOiAndGVtcGxhdGVzL2RpcmVjdGl2ZXMvbWFuYWdlLWFkLW1lbnUuaHRtbCcsXHJcbiAgICAgICAgcmVwbGFjZTogdHJ1ZVxyXG4gICAgfVxyXG59KTtcclxuIiwiJ3VzZSBzdHJpY3QnO1xyXG5cclxuYWRzQXBwLmRpcmVjdGl2ZSgnbmF2aWdhdGlvbicsIGZ1bmN0aW9uICgpIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgcmVzdHJpY3Q6ICdFJyxcclxuICAgICAgICB0ZW1wbGF0ZVVybDogJ3RlbXBsYXRlcy9kaXJlY3RpdmVzL25hdmlnYXRpb24uaHRtbCcsXHJcbiAgICAgICAgcmVwbGFjZTogdHJ1ZVxyXG4gICAgfVxyXG59KTtcclxuIiwiJ3VzZSBzdHJpY3QnO1xyXG5cclxuYWRzQXBwLmRpcmVjdGl2ZSgncHVibGljQWRzJywgZnVuY3Rpb24gKCkge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICBjb250cm9sbGVyOiAnUHVibGljQWRzQ3RybCcsXHJcbiAgICAgICAgcmVzdHJpY3Q6ICdFJyxcclxuICAgICAgICB0ZW1wbGF0ZVVybDogJ3RlbXBsYXRlcy9kaXJlY3RpdmVzL3B1YmxpYy1hZHMuaHRtbCcsXHJcbiAgICAgICAgcmVwbGFjZTogdHJ1ZVxyXG4gICAgfVxyXG59KTtcclxuIiwiJ3VzZSBzdHJpY3QnO1xyXG5cclxuYWRzQXBwLmRpcmVjdGl2ZSgncHVibGljTGVmdFNpZGViYXInLCBmdW5jdGlvbiAoKSB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIGNvbnRyb2xsZXI6ICdIb21lQ3RybCcsXHJcbiAgICAgICAgcmVzdHJpY3Q6ICdFJyxcclxuICAgICAgICB0ZW1wbGF0ZVVybDogJ3RlbXBsYXRlcy9kaXJlY3RpdmVzL2xlZnQtc2lkZWJhci5odG1sJyxcclxuICAgICAgICByZXBsYWNlOiB0cnVlXHJcbiAgICB9XHJcbn0pO1xyXG4iLCIndXNlIHN0cmljdCc7XHJcblxyXG5hZHNBcHAuZGlyZWN0aXZlKCdzdGF0dXNGaWx0ZXInLCBmdW5jdGlvbiAoKSB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIGNvbnRyb2xsZXI6ICdTdGF0dXNGaWx0ZXJDdHJsJyxcclxuICAgICAgICByZXN0cmljdDogJ0UnLFxyXG4gICAgICAgIHRlbXBsYXRlVXJsOiAndGVtcGxhdGVzL2RpcmVjdGl2ZXMvc3RhdHVzLWZpbHRlci5odG1sJyxcclxuICAgICAgICByZXBsYWNlOiB0cnVlXHJcbiAgICB9XHJcbn0pO1xyXG4iLCIndXNlIHN0cmljdCc7XHJcblxyXG5hZHNBcHAuZGlyZWN0aXZlKCd0b3ducycsIGZ1bmN0aW9uICgpIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgY29udHJvbGxlcjogJ1JpZ2h0U2lkZWJhckN0cmwnLFxyXG4gICAgICAgIHJlc3RyaWN0OiAnRScsXHJcbiAgICAgICAgdGVtcGxhdGVVcmw6ICd0ZW1wbGF0ZXMvZGlyZWN0aXZlcy90b3ducy5odG1sJyxcclxuICAgICAgICByZXBsYWNlOiB0cnVlXHJcbiAgICB9XHJcbn0pO1xyXG4iLCIndXNlIHN0cmljdCc7XHJcblxyXG5hZHNBcHAuZGlyZWN0aXZlKCd1c2VyQWRzJywgZnVuY3Rpb24gKCkge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICBjb250cm9sbGVyOiAnVXNlckFkc0N0cmwnLFxyXG4gICAgICAgIHJlc3RyaWN0OiAnRScsXHJcbiAgICAgICAgdGVtcGxhdGVVcmw6ICd0ZW1wbGF0ZXMvZGlyZWN0aXZlcy91c2VyLWFkcy5odG1sJyxcclxuICAgICAgICByZXBsYWNlOiB0cnVlXHJcbiAgICB9XHJcbn0pO1xyXG4iLCIndXNlIHN0cmljdCc7XHJcblxyXG5hZHNBcHAuZmFjdG9yeSgnYXV0aGVudGljYXRpb24nLCBbXHJcbiAgICAnbG9jYWxTdG9yYWdlU2VydmljZScsXHJcbiAgICBmdW5jdGlvbiAobG9jYWxTdG9yYWdlU2VydmljZSkge1xyXG5cclxuICAgICAgICB2YXIga2V5ID0gJ3VzZXInO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBzYXZlVXNlckRhdGEoZGF0YSkge1xyXG4gICAgICAgICAgICBsb2NhbFN0b3JhZ2VTZXJ2aWNlLnNldChrZXksIGRhdGEpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0VXNlckRhdGEoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBsb2NhbFN0b3JhZ2VTZXJ2aWNlLmdldChrZXkpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gcmVtb3ZlVXNlcigpIHtcclxuICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oJ2xzLnVzZXInKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldEhlYWRlcnMoKSB7XHJcbiAgICAgICAgICAgIHZhciBoZWFkZXJzID0ge307XHJcbiAgICAgICAgICAgIHZhciB1c2VyRGF0YSA9IGdldFVzZXJEYXRhKCk7XHJcblxyXG4gICAgICAgICAgICBpZiAodXNlckRhdGEpIHtcclxuICAgICAgICAgICAgICAgIGhlYWRlcnMuQXV0aG9yaXphdGlvbiA9ICdCZWFyZXIgJyArIHVzZXJEYXRhLmFjY2Vzc190b2tlbjtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGhlYWRlcnM7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBpc0FkbWluKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gZ2V0VXNlckRhdGEoKS5pc0FkbWluO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gaXNMb2dnZWRJbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuICEhZ2V0VXNlckRhdGEoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHNhdmVVc2VyOiBzYXZlVXNlckRhdGEsXHJcbiAgICAgICAgICAgIGdldFVzZXJEYXRhOiBnZXRVc2VyRGF0YSxcclxuICAgICAgICAgICAgcmVtb3ZlVXNlcjogcmVtb3ZlVXNlcixcclxuICAgICAgICAgICAgZ2V0SGVhZGVyczogZ2V0SGVhZGVycyxcclxuICAgICAgICAgICAgaXNBZG1pbjogaXNBZG1pbixcclxuICAgICAgICAgICAgaXNMb2dnZWRJbjogaXNMb2dnZWRJblxyXG4gICAgICAgIH1cclxuICAgIH1dKTtcclxuIiwiJ3VzZSBzdHJpY3QnO1xyXG5cclxuYWRzQXBwLmZhY3RvcnkoXHJcbiAgICAnbm90aWZpY2F0aW9uJyxcclxuICAgIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBzaG93SW5mbzogZnVuY3Rpb24gKG1zZykge1xyXG4gICAgICAgICAgICAgICAgbm90eSh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IG1zZyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2luZm8nLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBsYXlvdXQ6ICd0b3BDZW50ZXInLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aW1lb3V0OiAzMDAwXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgc2hvd0Vycm9yOiBmdW5jdGlvbiAobXNnLCBzZXJ2ZXJFcnJvcikge1xyXG4gICAgICAgICAgICAgICAgLy8gQ29sbGVjdCBlcnJvcnMgdG8gZGlzcGxheSBmcm9tIHRoZSBzZXJ2ZXIgcmVzcG9uc2VcclxuICAgICAgICAgICAgICAgIHZhciBlcnJvcnMgPSBbXTtcclxuICAgICAgICAgICAgICAgIGlmIChzZXJ2ZXJFcnJvciAmJiBzZXJ2ZXJFcnJvci5kYXRhLmVycm9yX2Rlc2NyaXB0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZXJyb3JzLnB1c2goc2VydmVyRXJyb3IuZGF0YS5lcnJvcl9kZXNjcmlwdGlvbik7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHNlcnZlckVycm9yICYmIHNlcnZlckVycm9yLmRhdGEubW9kZWxTdGF0ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBtb2RlbFN0YXRlRXJyb3JzID0gc2VydmVyRXJyb3IuZGF0YS5tb2RlbFN0YXRlO1xyXG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIHByb3BlcnR5TmFtZSBpbiBtb2RlbFN0YXRlRXJyb3JzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBlcnJvck1lc3NhZ2VzID0gbW9kZWxTdGF0ZUVycm9yc1twcm9wZXJ0eU5hbWVdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdHJpbW1lZE5hbWUgPVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvcGVydHlOYW1lLnN1YnN0cihwcm9wZXJ0eU5hbWUuaW5kZXhPZignLicpICsgMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZXJyb3JNZXNzYWdlcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGN1cnJlbnRFcnJvciA9IGVycm9yTWVzc2FnZXNbaV07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvcnMucHVzaCh0cmltbWVkTmFtZSArICcgLSAnICsgY3VycmVudEVycm9yKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoZXJyb3JzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICBtc2cgPSBtc2cgKyBcIjo8YnI+XCIgKyBlcnJvcnMuam9pbihcIjxicj5cIik7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgbm90eSh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IG1zZyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2Vycm9yJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGF5b3V0OiAndG9wQ2VudGVyJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGltZW91dDogNTAwMFxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbik7XHJcbiIsIid1c2Ugc3RyaWN0JztcclxuXHJcbmFkc0FwcC5mYWN0b3J5KCdhZHNEYXRhJywgW1xyXG4gICAgJyRyZXNvdXJjZScsXHJcbiAgICAnYXV0aGVudGljYXRpb24nLFxyXG4gICAgJ2Jhc2VTZXJ2aWNlVXJsJyxcclxuICAgIGZ1bmN0aW9uICgkcmVzb3VyY2UsIGF1dGhlbnRpY2F0aW9uLCBiYXNlU2VydmljZVVybCkge1xyXG4gICAgICAgIHZhciByZXNvdXJjZSA9ICRyZXNvdXJjZShiYXNlU2VydmljZVVybCArICdhZHMvOmFkSWQnLCB7YWRJZDogJ0BpZCd9LCB7XHJcbiAgICAgICAgICAgIHVwZGF0ZToge1xyXG4gICAgICAgICAgICAgICAgbWV0aG9kOiAnUFVUJ1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBnZXRBbGw6IHtcclxuICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCdcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBjcmVhdGVBZChhZCkge1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzb3VyY2Uuc2F2ZShhZCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXRQdWJsaWNBZHMocGFyYW1zKSB7XHJcbiAgICAgICAgICAgIHJldHVybiByZXNvdXJjZS5nZXRBbGwocGFyYW1zKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGVkaXRBZChhZElkLCBhZCkge1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzb3VyY2UudXBkYXRlKHtpZDogYWRJZH0sIGFkKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIGFkZDogY3JlYXRlQWQsXHJcbiAgICAgICAgICAgIGdldFB1YmxpY0FkczogZ2V0UHVibGljQWRzLFxyXG4gICAgICAgICAgICBlZGl0OiBlZGl0QWRcclxuICAgICAgICB9XHJcbiAgICB9XSk7XHJcbiIsIid1c2Ugc3RyaWN0JztcclxuXHJcbmFkc0FwcC5mYWN0b3J5KCdjYXRlZ29yaWVzRGF0YScsIFtcclxuICAgICckcmVzb3VyY2UnLFxyXG4gICAgJ2Jhc2VTZXJ2aWNlVXJsJyxcclxuICAgIGZ1bmN0aW9uICgkcmVzb3VyY2UsIGJhc2VTZXJ2aWNlVXJsKSB7XHJcblxyXG4gICAgICAgIHZhciByZXNvdXJjZSA9ICRyZXNvdXJjZShiYXNlU2VydmljZVVybCArICdjYXRlZ29yaWVzJyk7XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldENhdGVnb3JpZXMoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiByZXNvdXJjZS5xdWVyeSgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgZ2V0Q2F0ZWdvcmllczogZ2V0Q2F0ZWdvcmllc1xyXG4gICAgICAgIH1cclxuICAgIH1dKTtcclxuIiwiJ3VzZSBzdHJpY3QnO1xyXG5cclxuYWRzQXBwLmZhY3RvcnkoJ3Rvd25zRGF0YScsIFtcclxuICAgICckcmVzb3VyY2UnLFxyXG4gICAgJ2Jhc2VTZXJ2aWNlVXJsJyxcclxuICAgIGZ1bmN0aW9uICgkcmVzb3VyY2UsIGJhc2VTZXJ2aWNlVXJsKSB7XHJcblxyXG4gICAgICAgIHZhciByZXNvdXJjZSA9ICRyZXNvdXJjZShiYXNlU2VydmljZVVybCArICd0b3ducycpO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXRUb3ducygpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHJlc291cmNlLnF1ZXJ5KCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBnZXRUb3duczogZ2V0VG93bnNcclxuICAgICAgICB9XHJcbiAgICB9XSk7XHJcbiIsIid1c2Ugc3RyaWN0JztcclxuXHJcbmFkc0FwcC5mYWN0b3J5KCd1c2VyQWRzRGF0YScsIFtcclxuICAgICckcmVzb3VyY2UnLFxyXG4gICAgJ2F1dGhlbnRpY2F0aW9uJyxcclxuICAgICdiYXNlU2VydmljZVVybCcsXHJcbiAgICBmdW5jdGlvbiAoJHJlc291cmNlLCBhdXRoZW50aWNhdGlvbiwgYmFzZVNlcnZpY2VVcmwpIHtcclxuXHJcbiAgICAgICAgdmFyIHJlc291cmNlID0gJHJlc291cmNlKGJhc2VTZXJ2aWNlVXJsICsgJ3VzZXIvYWRzLzphZElkJywge2FkSWQ6ICdAaWQnfSwge1xyXG4gICAgICAgICAgICB1cGRhdGU6IHtcclxuICAgICAgICAgICAgICAgIG1ldGhvZDogJ1BVVCcsXHJcbiAgICAgICAgICAgICAgICBoZWFkZXJzOiBhdXRoZW50aWNhdGlvbi5nZXRIZWFkZXJzKClcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgZ2V0QWxsOiB7XHJcbiAgICAgICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxyXG4gICAgICAgICAgICAgICAgaGVhZGVyczogYXV0aGVudGljYXRpb24uZ2V0SGVhZGVycygpXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGdldDoge1xyXG4gICAgICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcclxuICAgICAgICAgICAgICAgIGhlYWRlcnM6IGF1dGhlbnRpY2F0aW9uLmdldEhlYWRlcnMoKVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICByZW1vdmU6IHtcclxuICAgICAgICAgICAgICAgIG1ldGhvZDogJ0RFTEVURScsXHJcbiAgICAgICAgICAgICAgICBoZWFkZXJzOiBhdXRoZW50aWNhdGlvbi5nZXRIZWFkZXJzKClcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgc2F2ZToge1xyXG4gICAgICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsXHJcbiAgICAgICAgICAgICAgICBoZWFkZXJzOiBhdXRoZW50aWNhdGlvbi5nZXRIZWFkZXJzKClcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBjcmVhdGVOZXdBZChhZCkge1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzb3VyY2Uuc2F2ZShhZCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXRVc2VyQWRzKHBhcmFtcykge1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzb3VyY2UuZ2V0QWxsKHBhcmFtcyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXRBZEJ5SWQoYWRJZCkge1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzb3VyY2UuZ2V0KHthZElkOiBhZElkfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBlZGl0QWQoYWRJZCwgYWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHJlc291cmNlLnVwZGF0ZSh7YWRJZDogYWRJZH0sIGFkKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGRlYWN0aXZhdGVBZChhZElkKSB7XHJcbiAgICAgICAgICAgIHZhciByZXNvdXJjZSA9ICRyZXNvdXJjZShiYXNlU2VydmljZVVybCArICd1c2VyL2Fkcy9kZWFjdGl2YXRlLzphZElkJywge2FkSWQ6ICdAaWQnfSwge1xyXG4gICAgICAgICAgICAgICAgdXBkYXRlOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiAnUFVUJyxcclxuICAgICAgICAgICAgICAgICAgICBoZWFkZXJzOiBhdXRoZW50aWNhdGlvbi5nZXRIZWFkZXJzKClcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gcmVzb3VyY2UudXBkYXRlKHtpZDogYWRJZH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gcHVibGlzaEFnYWluQWQoYWRJZCkge1xyXG4gICAgICAgICAgICB2YXIgcmVzb3VyY2UgPSAkcmVzb3VyY2UoYmFzZVNlcnZpY2VVcmwgKyAndXNlci9hZHMvcHVibGlzaGFnYWluLzphZElkJywge2FkSWQ6ICdAaWQnfSwge1xyXG4gICAgICAgICAgICAgICAgdXBkYXRlOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiAnUFVUJyxcclxuICAgICAgICAgICAgICAgICAgICBoZWFkZXJzOiBhdXRoZW50aWNhdGlvbi5nZXRIZWFkZXJzKClcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gcmVzb3VyY2UudXBkYXRlKHtpZDogYWRJZH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gcmVtb3ZlQWQoYWRJZCkge1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzb3VyY2UucmVtb3ZlKHthZElkOiBhZElkfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBhZGQ6IGNyZWF0ZU5ld0FkLFxyXG4gICAgICAgICAgICBnZXRVc2VyQWRzOiBnZXRVc2VyQWRzLFxyXG4gICAgICAgICAgICBnZXRBZEJ5SWQ6IGdldEFkQnlJZCxcclxuICAgICAgICAgICAgZWRpdDogZWRpdEFkLFxyXG4gICAgICAgICAgICBkZWFjdGl2YXRlOiBkZWFjdGl2YXRlQWQsXHJcbiAgICAgICAgICAgIHB1Ymxpc2hBZ2FpbjogcHVibGlzaEFnYWluQWQsXHJcbiAgICAgICAgICAgIGRlbGV0ZTogcmVtb3ZlQWRcclxuICAgICAgICB9XHJcbiAgICB9XSk7XHJcbiIsIid1c2Ugc3RyaWN0JztcclxuXHJcbmFkc0FwcC5mYWN0b3J5KCd1c2VyRGF0YScsIFtcclxuICAgICckaHR0cCcsXHJcbiAgICAnJHJlc291cmNlJyxcclxuICAgICdiYXNlU2VydmljZVVybCcsXHJcbiAgICAnYXV0aGVudGljYXRpb24nLFxyXG4gICAgZnVuY3Rpb24gKCRodHRwLCAkcmVzb3VyY2UsIGJhc2VTZXJ2aWNlVXJsLCBhdXRoZW50aWNhdGlvbikge1xyXG5cclxuICAgICAgICB2YXIgdXNlclNlcnZpY2VVcmwgPSBiYXNlU2VydmljZVVybCArICd1c2VyLyc7XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldFVzZXJQcm9maWxlKCkge1xyXG4gICAgICAgICAgICB2YXIgcmVzb3VyY2UgPSAkcmVzb3VyY2UodXNlclNlcnZpY2VVcmwgKyAncHJvZmlsZScsIHt9LCB7XHJcbiAgICAgICAgICAgICAgICBnZXQ6IHtcclxuICAgICAgICAgICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxyXG4gICAgICAgICAgICAgICAgICAgIGhlYWRlcnM6IGF1dGhlbnRpY2F0aW9uLmdldEhlYWRlcnMoKVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiByZXNvdXJjZS5nZXQoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHJlZ2lzdGVyVXNlcih1c2VyKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkcmVzb3VyY2UodXNlclNlcnZpY2VVcmwgKyAncmVnaXN0ZXInKVxyXG4gICAgICAgICAgICAgICAgLnNhdmUodXNlcik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBsb2dpblVzZXIodXNlcikge1xyXG4gICAgICAgICAgICB2YXIgcmVzb3VyY2UgPSAkcmVzb3VyY2UodXNlclNlcnZpY2VVcmwgKyAnbG9naW4nKVxyXG4gICAgICAgICAgICAgICAgLnNhdmUodXNlcik7XHJcblxyXG4gICAgICAgICAgICByZXNvdXJjZS4kcHJvbWlzZVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oXHJcbiAgICAgICAgICAgICAgICBmdW5jdGlvbiBzdWNjZXNzKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICBhdXRoZW50aWNhdGlvbi5zYXZlVXNlcihkYXRhKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgKTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiByZXNvdXJjZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGVkaXRVc2VyUHJvZmlsZSh1c2VyKSB7XHJcbiAgICAgICAgICAgIHZhciByZXNvdXJjZSA9ICRyZXNvdXJjZSh1c2VyU2VydmljZVVybCArICdwcm9maWxlJywge30sIHtcclxuICAgICAgICAgICAgICAgIHVwZGF0ZToge1xyXG4gICAgICAgICAgICAgICAgICAgIG1ldGhvZDogJ1BVVCcsXHJcbiAgICAgICAgICAgICAgICAgICAgaGVhZGVyczogYXV0aGVudGljYXRpb24uZ2V0SGVhZGVycygpXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHJlc291cmNlLnVwZGF0ZSh1c2VyKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGNoYW5nZVVzZXJQYXNzd29yZChwYXNzKSB7XHJcbiAgICAgICAgICAgIHZhciByZXNvdXJjZSA9ICRyZXNvdXJjZSh1c2VyU2VydmljZVVybCArICdjaGFuZ2VQYXNzd29yZCcsIHt9LCB7XHJcbiAgICAgICAgICAgICAgICB1cGRhdGU6IHtcclxuICAgICAgICAgICAgICAgICAgICBtZXRob2Q6ICdQVVQnLFxyXG4gICAgICAgICAgICAgICAgICAgIGhlYWRlcnM6IGF1dGhlbnRpY2F0aW9uLmdldEhlYWRlcnMoKVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiByZXNvdXJjZS51cGRhdGUocGFzcyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBsb2dvdXQoKSB7XHJcbiAgICAgICAgICAgIGF1dGhlbnRpY2F0aW9uLnJlbW92ZVVzZXIoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIGdldFVzZXJQcm9maWxlOiBnZXRVc2VyUHJvZmlsZSxcclxuICAgICAgICAgICAgcmVnaXN0ZXI6IHJlZ2lzdGVyVXNlcixcclxuICAgICAgICAgICAgbG9naW46IGxvZ2luVXNlcixcclxuICAgICAgICAgICAgZWRpdDogZWRpdFVzZXJQcm9maWxlLFxyXG4gICAgICAgICAgICBjaGFuZ2VQYXNzd29yZDogY2hhbmdlVXNlclBhc3N3b3JkLFxyXG4gICAgICAgICAgICBsb2dvdXQ6IGxvZ291dFxyXG4gICAgICAgIH1cclxuICAgIH1dKTtcclxuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9